(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,16015,(e,t,s)=>{},98547,(e,t,s)=>{var r=e.i(47167);e.r(16015);var i=e.r(71645),n=i&&"object"==typeof i&&"default"in i?i:{default:i},a=void 0!==r.default&&r.default.env&&!0,l=function(e){return"[object String]"===Object.prototype.toString.call(e)},c=function(){function e(e){var t=void 0===e?{}:e,s=t.name,r=void 0===s?"stylesheet":s,i=t.optimizeForSpeed,n=void 0===i?a:i;d(l(r),"`name` must be a string"),this._name=r,this._deletedRulePlaceholder="#"+r+"-deleted-rule____{}",d("boolean"==typeof n,"`optimizeForSpeed` must be a boolean"),this._optimizeForSpeed=n,this._serverSheet=void 0,this._tags=[],this._injected=!1,this._rulesCount=0;var c="u">typeof window&&document.querySelector('meta[property="csp-nonce"]');this._nonce=c?c.getAttribute("content"):null}var t,s=e.prototype;return s.setOptimizeForSpeed=function(e){d("boolean"==typeof e,"`setOptimizeForSpeed` accepts a boolean"),d(0===this._rulesCount,"optimizeForSpeed cannot be when rules have already been inserted"),this.flush(),this._optimizeForSpeed=e,this.inject()},s.isOptimizeForSpeed=function(){return this._optimizeForSpeed},s.inject=function(){var e=this;if(d(!this._injected,"sheet already injected"),this._injected=!0,"u">typeof window&&this._optimizeForSpeed){this._tags[0]=this.makeStyleTag(this._name),this._optimizeForSpeed="insertRule"in this.getSheet(),this._optimizeForSpeed||(a||console.warn("StyleSheet: optimizeForSpeed mode not supported falling back to standard mode."),this.flush(),this._injected=!0);return}this._serverSheet={cssRules:[],insertRule:function(t,s){return"number"==typeof s?e._serverSheet.cssRules[s]={cssText:t}:e._serverSheet.cssRules.push({cssText:t}),s},deleteRule:function(t){e._serverSheet.cssRules[t]=null}}},s.getSheetForTag=function(e){if(e.sheet)return e.sheet;for(var t=0;t<document.styleSheets.length;t++)if(document.styleSheets[t].ownerNode===e)return document.styleSheets[t]},s.getSheet=function(){return this.getSheetForTag(this._tags[this._tags.length-1])},s.insertRule=function(e,t){if(d(l(e),"`insertRule` accepts only strings"),"u"<typeof window)return"number"!=typeof t&&(t=this._serverSheet.cssRules.length),this._serverSheet.insertRule(e,t),this._rulesCount++;if(this._optimizeForSpeed){var s=this.getSheet();"number"!=typeof t&&(t=s.cssRules.length);try{s.insertRule(e,t)}catch(t){return a||console.warn("StyleSheet: illegal rule: \n\n"+e+"\n\nSee https://stackoverflow.com/q/20007992 for more info"),-1}}else{var r=this._tags[t];this._tags.push(this.makeStyleTag(this._name,e,r))}return this._rulesCount++},s.replaceRule=function(e,t){if(this._optimizeForSpeed||"u"<typeof window){var s="u">typeof window?this.getSheet():this._serverSheet;if(t.trim()||(t=this._deletedRulePlaceholder),!s.cssRules[e])return e;s.deleteRule(e);try{s.insertRule(t,e)}catch(r){a||console.warn("StyleSheet: illegal rule: \n\n"+t+"\n\nSee https://stackoverflow.com/q/20007992 for more info"),s.insertRule(this._deletedRulePlaceholder,e)}}else{var r=this._tags[e];d(r,"old rule at index `"+e+"` not found"),r.textContent=t}return e},s.deleteRule=function(e){if("u"<typeof window)return void this._serverSheet.deleteRule(e);if(this._optimizeForSpeed)this.replaceRule(e,"");else{var t=this._tags[e];d(t,"rule at index `"+e+"` not found"),t.parentNode.removeChild(t),this._tags[e]=null}},s.flush=function(){this._injected=!1,this._rulesCount=0,"u">typeof window?(this._tags.forEach(function(e){return e&&e.parentNode.removeChild(e)}),this._tags=[]):this._serverSheet.cssRules=[]},s.cssRules=function(){var e=this;return"u"<typeof window?this._serverSheet.cssRules:this._tags.reduce(function(t,s){return s?t=t.concat(Array.prototype.map.call(e.getSheetForTag(s).cssRules,function(t){return t.cssText===e._deletedRulePlaceholder?null:t})):t.push(null),t},[])},s.makeStyleTag=function(e,t,s){t&&d(l(t),"makeStyleTag accepts only strings as second parameter");var r=document.createElement("style");this._nonce&&r.setAttribute("nonce",this._nonce),r.type="text/css",r.setAttribute("data-"+e,""),t&&r.appendChild(document.createTextNode(t));var i=document.head||document.getElementsByTagName("head")[0];return s?i.insertBefore(r,s):i.appendChild(r),r},t=[{key:"length",get:function(){return this._rulesCount}}],function(e,t){for(var s=0;s<t.length;s++){var r=t[s];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(e.prototype,t),e}();function d(e,t){if(!e)throw Error("StyleSheet: "+t+".")}var o=function(e){for(var t=5381,s=e.length;s;)t=33*t^e.charCodeAt(--s);return t>>>0},x={};function u(e,t){if(!t)return"jsx-"+e;var s=String(t),r=e+s;return x[r]||(x[r]="jsx-"+o(e+"-"+s)),x[r]}function h(e,t){"u"<typeof window&&(t=t.replace(/\/style/gi,"\\/style"));var s=e+t;return x[s]||(x[s]=t.replace(/__jsx-style-dynamic-selector/g,e)),x[s]}var m=function(){function e(e){var t=void 0===e?{}:e,s=t.styleSheet,r=void 0===s?null:s,i=t.optimizeForSpeed,n=void 0!==i&&i;this._sheet=r||new c({name:"styled-jsx",optimizeForSpeed:n}),this._sheet.inject(),r&&"boolean"==typeof n&&(this._sheet.setOptimizeForSpeed(n),this._optimizeForSpeed=this._sheet.isOptimizeForSpeed()),this._fromServer=void 0,this._indices={},this._instancesCounts={}}var t=e.prototype;return t.add=function(e){var t=this;void 0===this._optimizeForSpeed&&(this._optimizeForSpeed=Array.isArray(e.children),this._sheet.setOptimizeForSpeed(this._optimizeForSpeed),this._optimizeForSpeed=this._sheet.isOptimizeForSpeed()),"u">typeof window&&!this._fromServer&&(this._fromServer=this.selectFromServer(),this._instancesCounts=Object.keys(this._fromServer).reduce(function(e,t){return e[t]=0,e},{}));var s=this.getIdAndRules(e),r=s.styleId,i=s.rules;if(r in this._instancesCounts){this._instancesCounts[r]+=1;return}var n=i.map(function(e){return t._sheet.insertRule(e)}).filter(function(e){return -1!==e});this._indices[r]=n,this._instancesCounts[r]=1},t.remove=function(e){var t=this,s=this.getIdAndRules(e).styleId;if(function(e,t){if(!e)throw Error("StyleSheetRegistry: "+t+".")}(s in this._instancesCounts,"styleId: `"+s+"` not found"),this._instancesCounts[s]-=1,this._instancesCounts[s]<1){var r=this._fromServer&&this._fromServer[s];r?(r.parentNode.removeChild(r),delete this._fromServer[s]):(this._indices[s].forEach(function(e){return t._sheet.deleteRule(e)}),delete this._indices[s]),delete this._instancesCounts[s]}},t.update=function(e,t){this.add(t),this.remove(e)},t.flush=function(){this._sheet.flush(),this._sheet.inject(),this._fromServer=void 0,this._indices={},this._instancesCounts={}},t.cssRules=function(){var e=this,t=this._fromServer?Object.keys(this._fromServer).map(function(t){return[t,e._fromServer[t]]}):[],s=this._sheet.cssRules();return t.concat(Object.keys(this._indices).map(function(t){return[t,e._indices[t].map(function(e){return s[e].cssText}).join(e._optimizeForSpeed?"":"\n")]}).filter(function(e){return!!e[1]}))},t.styles=function(e){var t,s;return t=this.cssRules(),void 0===(s=e)&&(s={}),t.map(function(e){var t=e[0],r=e[1];return n.default.createElement("style",{id:"__"+t,key:"__"+t,nonce:s.nonce?s.nonce:void 0,dangerouslySetInnerHTML:{__html:r}})})},t.getIdAndRules=function(e){var t=e.children,s=e.dynamic,r=e.id;if(s){var i=u(r,s);return{styleId:i,rules:Array.isArray(t)?t.map(function(e){return h(i,e)}):[h(i,t)]}}return{styleId:u(r),rules:Array.isArray(t)?t:[t]}},t.selectFromServer=function(){return Array.prototype.slice.call(document.querySelectorAll('[id^="__jsx-"]')).reduce(function(e,t){return e[t.id.slice(2)]=t,e},{})},e}(),p=i.createContext(null);function f(){return new m}function b(){return i.useContext(p)}p.displayName="StyleSheetContext";var g=n.default.useInsertionEffect||n.default.useLayoutEffect,j="u">typeof window?f():void 0;function v(e){var t=j||b();return t&&("u"<typeof window?t.add(e):g(function(){return t.add(e),function(){t.remove(e)}},[e.id,String(e.dynamic)])),null}v.dynamic=function(e){return e.map(function(e){return u(e[0],e[1])}).join(" ")},s.StyleRegistry=function(e){var t=e.registry,s=e.children,r=i.useContext(p),a=i.useState(function(){return r||t||f()})[0];return n.default.createElement(p.Provider,{value:a},s)},s.createStyleRegistry=f,s.style=v,s.useStyleRegistry=b},37902,(e,t,s)=>{t.exports=e.r(98547).style},37117,e=>{"use strict";var t=e.i(43476),s=e.i(71645),r=e.i(22016),i=e.i(75254);let n=(0,i.default)("chevron-right",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);var a=e.i(71689);let l=(0,i.default)("menu",[["path",{d:"M4 5h16",key:"1tepv9"}],["path",{d:"M4 12h16",key:"1lakjw"}],["path",{d:"M4 19h16",key:"1djgab"}]]);var c=e.i(59544),d=e.i(86535);let o=({project:e,onUpdate:r})=>{let[i,n]=(0,s.useState)({theme:e.concept?.theme||"",title:e.title||"",emotions:e.concept?.emotions||"",keywords:e.concept?.keywords||"",note:e.concept?.note||""});(0,s.useEffect)(()=>{n({theme:e.concept?.theme||"",title:e.title||"",emotions:e.concept?.emotions||"",keywords:e.concept?.keywords||"",note:e.concept?.note||""})},[e.concept]);let a=(e,t)=>{n({...i,[e]:t})},l=()=>{r({title:i.title,concept:{theme:i.theme,emotions:i.emotions,keywords:i.keywords,note:i.note}})};return(0,t.jsx)("div",{className:"space-y-8 max-w-3xl animate-in fade-in slide-in-from-bottom-4 duration-500",children:(0,t.jsxs)("div",{className:"bg-white p-6 rounded-xl border border-zinc-200 shadow-sm dark:bg-zinc-950 dark:border-zinc-800",children:[(0,t.jsxs)("h2",{className:"text-xl font-bold mb-6 flex items-center gap-2 text-zinc-900 dark:text-zinc-50",children:[(0,t.jsx)("span",{className:"flex items-center justify-center w-8 h-8 rounded-full bg-zinc-900 text-zinc-50 text-sm dark:bg-zinc-100 dark:text-zinc-900",children:"1"}),"企画コンセプト"]}),(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("label",{className:"text-sm font-semibold text-zinc-700 dark:text-zinc-300",children:"エピソードタイトル"}),(0,t.jsx)("p",{className:"text-sm text-zinc-500",children:"エピソードの題名を入力してください。"}),(0,t.jsx)("input",{type:"text",value:i.title,onChange:e=>a("title",e.target.value),onBlur:l,placeholder:"エピソードタイトルを入力...",className:"w-full p-3 rounded-lg border border-zinc-200 bg-zinc-50 focus:bg-white focus:ring-2 focus:ring-zinc-900 focus:outline-none transition-all text-zinc-900 dark:bg-zinc-900 dark:border-zinc-800 dark:text-zinc-50 dark:focus:ring-zinc-100 dark:focus:bg-zinc-900 font-bold text-base"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("label",{className:"text-sm font-semibold text-zinc-700 dark:text-zinc-300",children:"テーマ（一言で言うと？）"}),(0,t.jsx)("p",{className:"text-sm text-zinc-500",children:"例：「友情と犠牲」「AIと人間の共存」など、作品の核となる概念。"}),(0,t.jsx)("input",{type:"text",value:i.theme,onChange:e=>a("theme",e.target.value),onBlur:l,placeholder:"テーマを入力...",className:"w-full p-3 rounded-lg border border-zinc-200 bg-zinc-50 focus:bg-white focus:ring-2 focus:ring-zinc-900 focus:outline-none transition-all text-zinc-900 dark:bg-zinc-900 dark:border-zinc-800 dark:text-zinc-50 dark:focus:ring-zinc-100 dark:focus:bg-zinc-900"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("label",{className:"text-sm font-semibold text-zinc-700 dark:text-zinc-300",children:"読後感（読者にどう感じてほしい？）"}),(0,t.jsx)("p",{className:"text-sm text-zinc-500",children:"例：「スカッとする」「ほっこりする」「考えさせられる」"}),(0,t.jsx)("input",{type:"text",value:i.emotions,onChange:e=>a("emotions",e.target.value),onBlur:l,placeholder:"読後感を入力...",className:"w-full p-3 rounded-lg border border-zinc-200 bg-zinc-50 focus:bg-white focus:ring-2 focus:ring-zinc-900 focus:outline-none transition-all text-zinc-900 dark:bg-zinc-900 dark:border-zinc-800 dark:text-zinc-50 dark:focus:ring-zinc-100 dark:focus:bg-zinc-900"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("label",{className:"text-sm font-semibold text-zinc-700 dark:text-zinc-300",children:"キーワード（要素・モチーフ）"}),(0,t.jsx)("p",{className:"text-sm text-zinc-500",children:"例：「魔法学園」「タイムリープ」「猫」「ピアノ」"}),(0,t.jsx)("textarea",{value:i.keywords,onChange:e=>a("keywords",e.target.value),onBlur:l,rows:2,placeholder:"キーワードを列挙...",className:"w-full p-3 rounded-lg border border-zinc-200 bg-zinc-50 focus:bg-white focus:ring-2 focus:ring-zinc-900 focus:outline-none transition-all text-zinc-900 dark:bg-zinc-900 dark:border-zinc-800 dark:text-zinc-50 dark:focus:ring-zinc-100 dark:focus:bg-zinc-900 resize-none text-base"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("label",{className:"text-sm font-semibold text-zinc-700 dark:text-zinc-300",children:"イメージメモ"}),(0,t.jsx)("p",{className:"text-sm text-zinc-500",children:"思いついたアイデアやシーン、セリフなどを自由に書き留めてください。"}),(0,t.jsx)("textarea",{value:i.note,onChange:e=>a("note",e.target.value),onBlur:l,rows:6,placeholder:"自由にメモ...",className:"w-full p-3 rounded-lg border border-zinc-200 bg-zinc-50 focus:bg-white focus:ring-2 focus:ring-zinc-900 focus:outline-none transition-all text-zinc-900 dark:bg-zinc-900 dark:border-zinc-800 dark:text-zinc-50 dark:focus:ring-zinc-100 dark:focus:bg-zinc-900 resize-none text-base"})]})]})]})})};var x=e.i(7233),u=e.i(37727),h=e.i(50570),m=e.i(77183),p=e.i(76590),f=e.i(7311);let b={vs:{label:"VS",color:"text-red-600",bg:"bg-red-100 dark:bg-red-900/30 dark:text-red-400"},wakuwaku:{label:"ワクワク",color:"text-orange-600",bg:"bg-orange-100 dark:bg-orange-900/30 dark:text-orange-400"},dokidoki:{label:"ドキドキ",color:"text-purple-600",bg:"bg-purple-100 dark:bg-purple-900/30 dark:text-purple-400"},bikkuri:{label:"ビックリ",color:"text-blue-600",bg:"bg-blue-100 dark:bg-blue-900/30 dark:text-blue-400"}},g=({card:e,onDelete:s,onUpdate:r,isOverlay:i=!1})=>{let{attributes:n,listeners:a,setNodeRef:l,transform:c,transition:d,isDragging:o}=(0,p.useSortable)({id:e.id,data:{act:e.act}}),x={transform:f.CSS.Transform.toString(c),transition:d,opacity:o?.4:1};return(0,t.jsx)("div",{ref:l,style:x,className:`bg-white rounded-lg border border-zinc-200 p-3 shadow-sm group hover:border-zinc-300 dark:bg-zinc-900 dark:border-zinc-800 dark:hover:border-zinc-700 ${i?"shadow-xl cursor-grabbing":""}`,children:(0,t.jsxs)("div",{className:"flex items-start gap-2",children:[(0,t.jsx)("div",{...n,...a,className:"mt-1 text-zinc-300 hover:text-zinc-600 cursor-grab active:cursor-grabbing dark:text-zinc-700 dark:hover:text-zinc-400",children:(0,t.jsx)(h.GripVertical,{size:16})}),(0,t.jsxs)("div",{className:"flex-1 space-y-2",children:[(0,t.jsx)("textarea",{value:e.content,onChange:t=>r&&r(e.id,{content:t.target.value}),placeholder:"イベント等の内容",rows:2,className:"w-full bg-transparent text-sm resize-none focus:outline-none placeholder:text-zinc-400 text-zinc-900 dark:text-zinc-50",onMouseDown:e=>e.stopPropagation()}),(0,t.jsx)("div",{className:"flex flex-wrap gap-1",children:Object.keys(b).map(s=>(0,t.jsx)("button",{onClick:()=>(t=>{if(!r)return;let s=e.tags||[],i=s.includes(t)?s.filter(e=>e!==t):[...s,t];r(e.id,{tags:i})})(s),onMouseDown:e=>e.stopPropagation(),className:`px-1.5 py-0.5 text-[11px] rounded border transition-colors ${e.tags?.includes(s)?`${b[s].bg} ${b[s].color} border-transparent font-bold`:"bg-transparent text-zinc-400 border-zinc-200 dark:border-zinc-800 dark:text-zinc-600 hover:bg-zinc-50 dark:hover:bg-zinc-800"}`,children:b[s].label},s))})]}),s&&(0,t.jsx)("button",{onClick:()=>s(e.id),className:"text-zinc-300 hover:text-red-500 opacity-0 group-hover:opacity-100 transition-opacity",onMouseDown:e=>e.stopPropagation(),children:(0,t.jsx)(u.X,{size:14})})]})})};var j=e.i(94931),v=e.i(84614),z=e.i(27612),y=e.i(55436),w=e.i(43531);let N=(0,i.default)("link",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]]),k=(0,i.default)("external-link",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]),S=(0,i.default)("message-square",[["path",{d:"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z",key:"18887p"}]]),C=(0,i.default)("sticky-note",[["path",{d:"M21 9a2.4 2.4 0 0 0-.706-1.706l-3.588-3.588A2.4 2.4 0 0 0 15 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2z",key:"1dfntj"}],["path",{d:"M15 3v5a1 1 0 0 0 1 1h5",key:"6s6qgf"}]]),_=(0,i.default)("eraser",[["path",{d:"M21 21H8a2 2 0 0 1-1.42-.587l-3.994-3.999a2 2 0 0 1 0-2.828l10-10a2 2 0 0 1 2.829 0l5.999 6a2 2 0 0 1 0 2.828L12.834 21",key:"g5wo59"}],["path",{d:"m5.082 11.09 8.828 8.828",key:"1wx5vj"}]]),I=(0,i.default)("undo-2",[["path",{d:"M9 14 4 9l5-5",key:"102s5s"}],["path",{d:"M4 9h10.5a5.5 5.5 0 0 1 5.5 5.5a5.5 5.5 0 0 1-5.5 5.5H11",key:"f3b9sd"}]]),R=(0,i.default)("redo-2",[["path",{d:"m15 14 5-5-5-5",key:"12vg1m"}],["path",{d:"M20 9H9.5A5.5 5.5 0 0 0 4 14.5A5.5 5.5 0 0 0 9.5 20H13",key:"6uklza"}]]),T=({initialData:e,onChange:r,className:i="",showTools:n=!0})=>{let a=(0,s.useRef)(null),[l,c]=(0,s.useState)(!1),[d,o]=(0,s.useState)(null),[x,u]=(0,s.useState)(1),[h,m]=(0,s.useState)("pen"),[p,f]=(0,s.useState)([]),[b,g]=(0,s.useState)([]),j=(0,s.useRef)([]),v=(0,s.useRef)(void 0);(0,s.useEffect)(()=>{let t=a.current;if(!t)return;let s=t.getContext("2d",{alpha:!0});if(s)if(s.lineJoin="round",s.lineCap="round",s.lineWidth=x,s.strokeStyle="#000000",o(s),e){let r=new Image;r.onload=()=>{s.clearRect(0,0,t.width,t.height),s.drawImage(r,0,0),f([e])},r.src=e}else s.clearRect(0,0,t.width,t.height),f([""])},[e]),(0,s.useEffect)(()=>{if(e&&!p.includes(e)){let t=new Image;t.onload=()=>{d?.clearRect(0,0,a.current.width,a.current.height),d?.drawImage(t,0,0),f(t=>[...t,e]),g([])},t.src=e}},[e,p,d]),(0,s.useEffect)(()=>{d&&(d.lineWidth=x,d.globalCompositeOperation="eraser"===h?"destination-out":"source-over","pen"===h&&(d.strokeStyle="#000000"))},[x,h,d]);let z=(0,s.useCallback)(()=>{if(a.current){let e=a.current.toDataURL();f(t=>[...t,e]),g([]),r(e)}},[r]),y=(0,s.useCallback)(()=>{if(p.length<=1)return;let e=[...p],t=e.pop();g(e=>[...e,t]),f(e);let s=e[e.length-1],i=a.current;if(i&&d){if(d.clearRect(0,0,i.width,i.height),s){let e=new Image;e.onload=()=>d.drawImage(e,0,0),e.src=s}r(s)}},[p,d,r]),w=(0,s.useCallback)(()=>{if(0===b.length)return;let e=[...b],t=e.pop();f(e=>[...e,t]),g(e);let s=a.current;if(s&&d){d.clearRect(0,0,s.width,s.height);let e=new Image;e.onload=()=>d.drawImage(e,0,0),e.src=t,r(t)}},[b,d,r]);(0,s.useEffect)(()=>{if(!n)return;let e=e=>{let t=e.ctrlKey||e.metaKey,s=e.shiftKey;t&&!s&&"z"===e.key?(e.preventDefault(),y()):(t&&s&&"z"===e.key||t&&"y"===e.key)&&(e.preventDefault(),w())};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[y,w,n]);let N=e=>{let t=a.current;if(!t)return{x:0,y:0};let s=t.getBoundingClientRect();return{x:(e.clientX-s.left)*(t.width/s.width),y:(e.clientY-s.top)*(t.height/s.height)}},k=(0,s.useCallback)(()=>{if(!d||j.current.length<2)return;let e=j.current;d.beginPath(),d.moveTo(e[0].x,e[0].y);for(let t=1;t<e.length-2;t++){let s=(e[t].x+e[t+1].x)/2,r=(e[t].y+e[t+1].y)/2;d.quadraticCurveTo(e[t].x,e[t].y,s,r)}if(e.length>2){let t=e.length-2;d.quadraticCurveTo(e[t].x,e[t].y,e[t+1].x,e[t+1].y)}else 2===e.length&&d.lineTo(e[1].x,e[1].y);d.stroke()},[d]),S=()=>{l&&(c(!1),v.current&&cancelAnimationFrame(v.current),j.current=[],z())};return(0,t.jsxs)("div",{className:`flex flex-col bg-[#0a0a0a] border border-zinc-800 rounded-lg overflow-hidden w-full ${i}`,children:[(0,t.jsx)("div",{className:"relative w-full aspect-video bg-white overflow-hidden touch-none",children:(0,t.jsx)("canvas",{ref:a,width:320,height:180,onPointerDown:e=>{if(!d)return;c(!0);let t=N(e);j.current=[t],d.beginPath(),d.moveTo(t.x,t.y)},onPointerMove:e=>{if(l&&d){for(let t of e.nativeEvent.getCoalescedEvents?.()||[e.nativeEvent]){let e=N(t);j.current.push(e)}v.current&&cancelAnimationFrame(v.current),v.current=requestAnimationFrame(()=>{k()})}},onPointerUp:S,onPointerLeave:S,onPointerCancel:S,className:"w-full h-full block cursor-crosshair touch-none relative z-10"})}),n&&(0,t.jsxs)("div",{className:"bg-zinc-950 border-t border-zinc-800 p-3 md:p-4 flex flex-wrap items-center justify-between gap-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsxs)("div",{className:"flex gap-1 bg-zinc-900 p-1 rounded-xl border border-white/5",children:[(0,t.jsxs)("button",{onClick:()=>m("pen"),className:`w-12 h-10 flex flex-col items-center justify-center rounded-lg transition-all ${"pen"===h?"bg-primary text-white font-bold":"text-zinc-500 hover:text-white"}`,title:"ペン",children:[(0,t.jsx)("span",{className:"text-[14px]",children:"✎"}),(0,t.jsx)("span",{className:"text-[8px] font-black leading-tight",children:"ペン"})]}),(0,t.jsxs)("button",{onClick:()=>m("eraser"),className:`w-12 h-10 flex flex-col items-center justify-center rounded-lg transition-all ${"eraser"===h?"bg-primary text-white font-bold":"text-zinc-500 hover:text-white"}`,title:"消しゴム",children:[(0,t.jsx)(_,{size:14}),(0,t.jsx)("span",{className:"text-[8px] font-black leading-tight",children:"消しゴム"})]})]}),(0,t.jsxs)("div",{className:"flex gap-1 bg-zinc-900 p-1 rounded-xl border border-white/5",children:[(0,t.jsx)("button",{onClick:y,disabled:p.length<=1,className:"w-10 h-10 flex items-center justify-center rounded-lg text-zinc-400 hover:bg-zinc-800 hover:text-white disabled:opacity-20 transition-all",title:"元に戻す (Ctrl+Z)",children:(0,t.jsx)(I,{size:18})}),(0,t.jsx)("button",{onClick:w,disabled:0===b.length,className:"w-10 h-10 flex items-center justify-center rounded-lg text-zinc-400 hover:bg-zinc-800 hover:text-white disabled:opacity-20 transition-all",title:"やり直し (Ctrl+Y / Ctrl+Shift+Z)",children:(0,t.jsx)(R,{size:18})})]}),(0,t.jsx)("div",{className:"flex gap-1 bg-zinc-900 p-1 rounded-xl border border-white/5",children:[{id:"extra-fine",label:"極細",value:1,dotSize:"w-0.5 h-0.5"},{id:"fine",label:"細",value:3,dotSize:"w-1.5 h-1.5"},{id:"medium",label:"中",value:6,dotSize:"w-2.5 h-2.5"}].map(e=>(0,t.jsxs)("button",{onClick:()=>u(e.value),className:`flex flex-col items-center justify-center min-w-[48px] h-10 rounded-lg transition-all ${x===e.value?"bg-primary text-white font-bold shadow-lg":"text-zinc-500 hover:bg-zinc-800 hover:text-white"}`,children:[(0,t.jsx)("div",{className:`rounded-full mb-0.5 ${e.dotSize} ${x===e.value?"bg-white":"bg-current"}`}),(0,t.jsx)("span",{className:"text-[9px] font-black",children:e.label})]},e.id))})]}),(0,t.jsxs)("button",{onClick:()=>{d&&a.current&&(d.clearRect(0,0,a.current.width,a.current.height),z())},className:"flex items-center gap-2 px-4 h-10 bg-zinc-900 border border-white/5 rounded-xl text-zinc-400 hover:bg-red-500 hover:text-white hover:border-red-600 transition-all font-bold",children:[(0,t.jsx)(_,{size:14}),(0,t.jsx)("span",{className:"text-sm",children:"クリア"})]})]})]})},D=(0,i.default)("save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]),E=({isOpen:e,onClose:r,initialData:i,onSave:n,title:a="ネームの下書き"})=>{let[l,d]=(0,s.useState)(i),[o,x]=(0,s.useState)(!1),[h,m]=(0,s.useState)(!1);if((0,s.useEffect)(()=>{e&&(d(i),x(!1),m(!1))},[e,i]),!e)return null;let p=async()=>{if(!o){x(!0);try{await n(l),m(!0),setTimeout(()=>{m(!1),r()},800)}catch(e){console.error("Save failed:",e),x(!1)}}};return(0,t.jsxs)("div",{id:"modal-overlay",className:"fixed inset-0 z-[100] bg-black/95 flex flex-col p-0 m-0 animate-in fade-in duration-300",onClick:e=>{"modal-overlay"===e.target.id&&p()},children:[h&&(0,t.jsxs)("div",{className:"fixed top-12 left-1/2 -translate-x-1/2 z-[150] bg-white text-black px-8 py-3 rounded-full font-black shadow-[0_10px_40px_rgba(255,255,255,0.2)] flex items-center gap-3 animate-in slide-in-from-top-8",children:[(0,t.jsx)("div",{className:"w-2.5 h-2.5 bg-green-500 rounded-full animate-pulse"}),"保存しました"]}),(0,t.jsxs)("div",{className:"h-20 flex items-center justify-between px-8 bg-zinc-950 border-b border-white/5",onClick:e=>e.stopPropagation(),children:[(0,t.jsxs)("div",{className:"flex items-center gap-6",children:[(0,t.jsx)("button",{onClick:r,disabled:o,className:"p-3 text-zinc-500 hover:text-white hover:bg-zinc-900 rounded-xl transition-all disabled:opacity-30",title:"変更を破棄して閉じる",children:(0,t.jsx)(u.X,{size:28})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"text-white font-black text-xl tracking-tight",children:a}),(0,t.jsx)("p",{className:"text-sm text-zinc-600 font-bold uppercase tracking-widest mt-0.5",children:"Focus Mode / Full Screen"})]})]}),(0,t.jsxs)(c.Button,{onClick:p,disabled:o,size:"lg",className:"bg-white text-black hover:bg-zinc-200 font-black px-8 h-12 rounded-xl disabled:bg-zinc-700",children:[(0,t.jsx)(D,{size:20,className:"mr-2"}),o?"保存中...":"保存して閉じる"]})]}),(0,t.jsxs)("div",{className:"flex-1 overflow-hidden flex flex-col items-center justify-center p-6 md:p-12",onClick:e=>{"editor-container"===e.target.id&&p()},id:"editor-container",children:[(0,t.jsx)("div",{className:"w-full max-w-5xl bg-zinc-950 rounded-2xl shadow-[0_0_100px_rgba(255,255,255,0.03)] border border-white/10 overflow-hidden",onClick:e=>e.stopPropagation(),children:(0,t.jsx)(T,{initialData:i,onChange:d,className:"w-full border-0",showTools:!0})}),(0,t.jsx)("div",{className:"mt-8 text-zinc-600 text-xs font-bold tracking-widest uppercase opacity-40",children:"画面の外側をタップしてクイック保存"})]})]})},B=e=>{let{dialogue:r,panelId:i,groupId:n,characters:a,groups:l,onUpdate:c,onDelete:d}=e,o=a?.find(e=>e.id===r.characterId),{attributes:x,listeners:u,setNodeRef:m,transform:b,transition:g,isDragging:j}=(0,p.useSortable)({id:r.id,data:{type:"dialogue",panelId:i,groupId:n}}),y={transform:f.CSS.Transform.toString(b),transition:g,opacity:j?.3:1,zIndex:50*!!j},[w,N]=(0,s.useState)(!!r.memo);return(0,t.jsx)("div",{ref:m,style:y,className:`bg-[#0a0a0a]/50 backdrop-blur-sm border ${j?"border-zinc-400":"border-zinc-700"} rounded-lg p-3 group/dialogue transition-all hover:bg-zinc-800 hover:border-zinc-600`,children:(0,t.jsxs)("div",{className:"flex items-start gap-3",children:[(0,t.jsx)("div",{...x,...u,className:"text-zinc-400 hover:text-white cursor-grab active:cursor-grabbing mt-2 shrink-0",children:(0,t.jsx)(h.GripVertical,{size:16})}),(0,t.jsxs)("div",{className:"relative w-8 h-8 rounded-full bg-zinc-700 border border-zinc-600 overflow-hidden flex items-center justify-center shrink-0 mt-0.5 group/icon cursor-pointer",children:[o?.icon?(0,t.jsx)("img",{src:o.icon,alt:o.name,className:"w-full h-full object-cover"}):(0,t.jsx)(v.User,{size:16,className:"text-zinc-400"}),a&&a.length>0&&(0,t.jsxs)("select",{value:r.characterId||"",onChange:e=>{let t=e.target.value,s=a.find(e=>e.id===t)?.name||"";c(n,i,r.id,{characterId:t,character:s})},className:"absolute inset-0 opacity-0 cursor-pointer text-[16px] w-full h-full",title:"キャラクターを選択",children:[(0,t.jsx)("option",{value:"",children:"キャラクター選択解除"}),l&&l.length>0?l.map(e=>{let s=a.filter(t=>t.groupIds?.includes(e.id));return 0===s.length?null:(0,t.jsx)("optgroup",{label:e.name,children:s.map(e=>(0,t.jsx)("option",{value:e.id,children:e.name},e.id))},e.id)}):a.map(e=>(0,t.jsx)("option",{value:e.id,children:e.name},e.id)),l&&l.length>0&&a.filter(e=>!e.groupIds||0===e.groupIds.length).length>0&&(0,t.jsx)("optgroup",{label:"その他",children:a.filter(e=>!e.groupIds||0===e.groupIds.length).map(e=>(0,t.jsx)("option",{value:e.id,children:e.name},e.id))})]})]}),(0,t.jsx)("div",{className:"w-28 shrink-0 mt-1",children:(0,t.jsx)("input",{value:r.character,onChange:e=>c(n,i,r.id,{character:e.target.value}),placeholder:"名前",className:"bg-transparent text-base font-bold text-zinc-300 placeholder:text-zinc-500 focus:outline-none w-full border-b border-transparent focus:border-zinc-600 pb-0.5"})}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsx)("textarea",{value:r.text,onChange:e=>c(n,i,r.id,{text:e.target.value}),placeholder:"セリフを入力...",rows:1,className:"w-full bg-transparent text-base text-zinc-100 placeholder:text-zinc-500 focus:outline-none resize-none leading-relaxed py-1.5 min-h-[32px]"}),w&&(0,t.jsxs)("div",{className:"relative mt-1",children:[(0,t.jsx)("input",{value:r.memo,onChange:e=>c(n,i,r.id,{memo:e.target.value}),placeholder:"演出メモを入力...",className:"w-full bg-zinc-900/50 border border-zinc-700/50 rounded px-2 py-1 text-base text-zinc-300 placeholder:text-zinc-500 focus:outline-none focus:border-zinc-600 focus:bg-zinc-900 transition-colors"}),(0,t.jsx)("button",{onClick:()=>{c(n,i,r.id,{memo:""}),N(!1)},className:"absolute right-1 top-1/2 -translate-y-1/2 text-zinc-600 hover:text-zinc-400 p-1",title:"メモを削除して閉じる",children:(0,t.jsx)(z.Trash2,{size:12})})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-1 mt-0.5 shrink-0 opacity-0 group-hover/dialogue:opacity-100 transition-opacity",children:[!w&&(0,t.jsx)("button",{onClick:()=>N(!0),className:"p-2 text-zinc-500 hover:text-zinc-300 transition-colors",title:"演出メモを追加",children:(0,t.jsx)(C,{size:16})}),(0,t.jsx)("button",{onClick:()=>d(n,i,r.id),className:"p-2 text-zinc-500 hover:text-red-400 transition-colors",title:"削除",children:(0,t.jsx)(z.Trash2,{size:16})})]})]})})},F=({item:e,parentId:s,activeId:r,activeType:i,characters:n,groups:a,onUpdateItem:l,onDeleteItem:d,onAddDialogue:o,onUpdateDialogue:u,onDeleteDialogue:b,onOpenModal:g})=>{let{attributes:j,listeners:v,setNodeRef:y,transform:w,transition:N,isDragging:k}=(0,p.useSortable)({id:e.id,data:{type:"panel",parentId:s}}),{setNodeRef:C,isOver:_}=(0,m.useDroppable)({id:`droppable-dialogue-${e.id}`,data:{type:"dialogue-container",panelId:e.id,parentId:s}}),I={transform:f.CSS.Transform.toString(w),transition:N,opacity:k?.3:1},R=_&&"dialogue"===i;return(0,t.jsxs)("div",{ref:y,style:I,className:`bg-zinc-900 rounded-xl border transition-all duration-200 overflow-hidden flex flex-col md:flex-row items-stretch md:items-start w-full relative min-h-[220px] 
                ${k?"border-zinc-400 shadow-xl":"border-zinc-800"}
                ${R?"ring-2 ring-zinc-400 ring-inset bg-zinc-800":""}
                group`,children:[(0,t.jsx)("button",{onClick:()=>d(s,e.id),className:"absolute top-4 right-4 p-2 bg-[#0a0a0a]/80 border border-zinc-700 rounded-lg text-zinc-400 hover:text-red-400 hover:border-red-400 transition-all z-40 opacity-0 group-hover:opacity-100",title:"パネルを削除",children:(0,t.jsx)(z.Trash2,{size:18})}),(0,t.jsxs)("div",{className:"relative w-full md:w-[320px] flex-shrink-0 flex flex-col items-stretch max-h-fit overflow-hidden cursor-pointer group/canvas bg-[#0a0a0a] rounded-t-lg md:rounded-l-lg md:rounded-tr-none",onClick:()=>g(e,s),children:[(0,t.jsx)("div",{className:"absolute inset-0 bg-[#0a0a0a]/60 opacity-0 group-hover/canvas:opacity-100 transition-opacity z-10 flex items-center justify-center",children:(0,t.jsx)("span",{className:"bg-zinc-900 text-white text-sm font-bold px-4 py-2 rounded-full border border-zinc-600 shadow-lg",children:"タップして全画面で描画"})}),(0,t.jsx)(T,{initialData:e.drawing,onChange:t=>l(s,e.id,{drawing:t}),className:"w-full h-full pointer-events-none",showTools:!1}),(0,t.jsx)("div",{...j,...v,className:"absolute top-3 left-3 p-2 bg-zinc-900/80 border border-zinc-600 rounded shadow-md opacity-0 group-hover:opacity-100 transition-opacity cursor-grab active:cursor-grabbing text-white z-20",onClick:e=>e.stopPropagation(),children:(0,t.jsx)(h.GripVertical,{size:18})})]}),(0,t.jsxs)("div",{ref:C,className:`flex-1 p-6 flex flex-col min-w-0 self-stretch transition-colors ${R?"bg-zinc-800":"bg-zinc-900/40"}`,children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-4 pr-12",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 text-zinc-400",children:[(0,t.jsx)(S,{size:16}),(0,t.jsx)("span",{className:"text-sm font-bold",children:"セリフ・演出"})]}),(0,t.jsxs)(c.Button,{variant:"ghost",size:"sm",onClick:()=>o(s,e.id),className:"text-sm font-bold text-zinc-400 hover:text-white hover:bg-zinc-800 border border-zinc-800 hover:border-zinc-600 px-3",children:[(0,t.jsx)(x.Plus,{size:14,className:"mr-1.5"})," 追加"]})]}),(0,t.jsxs)("div",{className:"space-y-3 flex-1 overflow-y-auto pr-2",children:[(0,t.jsx)(p.SortableContext,{items:e.dialogues?.map(e=>e.id)||[],strategy:p.verticalListSortingStrategy,children:e.dialogues?.map(r=>(0,t.jsx)(B,{dialogue:r,panelId:e.id,groupId:s,characters:n,groups:a,onUpdate:u,onDelete:b},r.id))}),(!e.dialogues||0===e.dialogues.length)&&(0,t.jsx)("div",{className:`h-full min-h-[100px] flex items-center justify-center border border-dashed rounded-lg transition-colors ${R?"border-zinc-500 bg-zinc-800":"border-zinc-800"}`,children:(0,t.jsx)("span",{className:"text-sm text-zinc-500 font-bold",children:R?"ここにドロップ":"セリフがありません"})})]})]})]})},M=({group:e,activeId:s,activeType:r,characters:i,groups:a,onAddItem:l,onUpdateItem:d,onDeleteItem:o,onAddDialogue:u,onUpdateDialogue:h,onDeleteDialogue:f,onOpenModal:g})=>{let{setNodeRef:j}=(0,m.useDroppable)({id:e.id,data:{type:"group"}});return(0,t.jsxs)("div",{ref:j,className:"space-y-8",children:[(0,t.jsxs)("div",{className:"flex items-center gap-4 border-b border-zinc-800 pb-2",children:[(0,t.jsxs)("h3",{className:"text-lg font-bold text-white flex items-center gap-2",children:[(0,t.jsx)(n,{size:20,className:"text-zinc-500"}),(0,t.jsx)("span",{children:e.content||"名称未定のエピソード"}),e.tags&&e.tags.length>0&&(0,t.jsx)("div",{className:"flex gap-1 ml-2",children:e.tags.map(e=>(0,t.jsx)("span",{className:`px-1.5 py-0.5 text-sm rounded border font-bold ${b[e]?.bg} ${b[e]?.color} border-transparent`,children:b[e]?.label},e))})]}),(0,t.jsx)("div",{className:"flex-1"}),(0,t.jsxs)(c.Button,{variant:"ghost",size:"sm",onClick:()=>l(e.id),className:"text-sm font-bold text-zinc-400 hover:text-white hover:bg-zinc-800 px-4",children:[(0,t.jsx)(x.Plus,{size:16,className:"mr-1.5"})," パネル追加"]})]}),(0,t.jsxs)("div",{className:"flex flex-col gap-10 p-4 max-w-5xl mx-auto",children:[(0,t.jsx)(p.SortableContext,{items:e.scenes?.map(e=>e.id)||[],strategy:p.verticalListSortingStrategy,children:e.scenes?.map(n=>(0,t.jsx)(F,{item:n,activeId:s,activeType:r,parentId:e.id,characters:i,groups:a,onUpdateItem:d,onDeleteItem:o,onAddDialogue:u,onUpdateDialogue:h,onDeleteDialogue:f,onOpenModal:g},n.id))}),e.scenes?.length===0?(0,t.jsxs)("div",{className:"py-20 flex flex-col items-center justify-center border-2 border-dashed border-zinc-800 rounded-3xl opacity-50 hover:opacity-100 transition-opacity",children:[(0,t.jsx)("p",{className:"text-zinc-500 text-sm font-bold mb-4",children:"パネルがありません"}),(0,t.jsxs)(c.Button,{onClick:()=>l(e.id),className:"bg-zinc-800 hover:bg-zinc-700 text-white font-bold px-6 py-2 rounded-full",children:[(0,t.jsx)(x.Plus,{size:16,className:"mr-2"})," 最初の一枚を追加"]})]}):(0,t.jsx)("div",{className:"flex justify-center pt-4",children:(0,t.jsxs)(c.Button,{variant:"ghost",onClick:()=>l(e.id),className:"text-sm font-bold text-zinc-500 hover:text-white border border-dashed border-zinc-700 hover:border-zinc-500 px-8 py-6 rounded-xl w-full",children:[(0,t.jsx)(x.Plus,{size:16,className:"mr-2"})," ここにパネルを追加"]})})]})]})};var O=e.i(37902);let P=(0,i.default)("printer",[["path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2",key:"143wyd"}],["path",{d:"M6 9V3a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v6",key:"1itne7"}],["rect",{x:"6",y:"14",width:"12",height:"8",rx:"1",key:"1ue0tg"}]]);var A=e.i(10980);let U=(0,i.default)("film",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M7 3v18",key:"bbkbws"}],["path",{d:"M3 7.5h4",key:"zfgn84"}],["path",{d:"M3 12h18",key:"1i2n21"}],["path",{d:"M3 16.5h4",key:"1230mu"}],["path",{d:"M17 3v18",key:"in4fa5"}],["path",{d:"M17 7.5h4",key:"myr1c1"}],["path",{d:"M17 16.5h4",key:"go4c1d"}]]);var $=e.i(44972);let L=[{id:"1",label:"1. 企画コンセプト",component:o},{id:"2",label:"2. あらすじ作成",component:({project:e,onUpdate:r})=>{let[i,n]=(0,s.useState)({start:"",midpoint:"",decision:"",end:""});(0,s.useEffect)(()=>{e.outline&&n(e.outline)},[e.outline]);let a=()=>{r({outline:i})};return(0,t.jsx)("div",{className:"space-y-8 max-w-3xl animate-in fade-in slide-in-from-bottom-4 duration-500",children:(0,t.jsxs)("div",{className:"bg-white p-6 rounded-xl border border-zinc-200 shadow-sm dark:bg-zinc-950 dark:border-zinc-800",children:[(0,t.jsxs)("h2",{className:"text-xl font-bold mb-6 flex items-center gap-2 text-zinc-900 dark:text-zinc-50",children:[(0,t.jsx)("span",{className:"flex items-center justify-center w-8 h-8 rounded-full bg-zinc-900 text-zinc-50 text-sm dark:bg-zinc-100 dark:text-zinc-900",children:"2"}),"あらすじ作成"]}),(0,t.jsx)("p",{className:"text-sm text-zinc-500 mb-8 dark:text-zinc-400",children:"物語の骨組みとなる4つのポイントを決めましょう。「開始」と「終了」が変化していることが重要です。"}),(0,t.jsxs)("div",{className:"grid grid-cols-1 gap-8 relative",children:[(0,t.jsx)("div",{className:"hidden md:block absolute left-[19px] top-6 bottom-6 w-0.5 bg-zinc-100 dark:bg-zinc-800 -z-10"}),[{key:"start",label:"1. 開始（Start）",desc:"主人公の初期状態。ゴールの正反対の状態を描く。",placeholder:"例：魔法が使えず、誰からも期待されていない落ちこぼれ。"},{key:"midpoint",label:"2. 中間点（Midpoint）",desc:"物語の転換点。主人公が変化せざるを得ない出来事。",placeholder:"例：師匠が敵に捕まり、自分一人で戦うしかない状況になる。"},{key:"decision",label:"3. 決断（Decision）",desc:"変化の証明。過去の自分と決別し、リスクを取る決断。",placeholder:"例：逃げることをやめ、禁忌とされていた機械技術を使うことを決意する。"},{key:"end",label:"4. 終了（End）",desc:"ゴール。主人公が得た新しい日常や成長の結果。",placeholder:"例：魔法と科学を融合させた英雄として認められ、新しい時代を作る。"}].map(e=>(0,t.jsxs)("div",{className:"relative pl-0 md:pl-12",children:[(0,t.jsx)("div",{className:"hidden md:flex absolute left-0 top-0 w-10 h-10 rounded-full bg-zinc-100 border-4 border-white items-center justify-center text-zinc-500 font-bold dark:bg-zinc-800 dark:border-zinc-950 dark:text-zinc-400",children:e.label.split(".")[0]}),(0,t.jsxs)("div",{className:"space-y-2 group",children:[(0,t.jsxs)("label",{className:"text-base font-bold text-zinc-900 dark:text-zinc-50 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-1",children:[e.label,(0,t.jsx)("span",{className:"text-sm font-normal text-zinc-500 bg-zinc-50 px-2 py-1 rounded dark:bg-zinc-900",children:e.desc})]}),(0,t.jsx)("textarea",{value:i[e.key],onChange:t=>{var s,r;return s=e.key,r=t.target.value,void n(e=>({...e,[s]:r}))},onBlur:a,rows:4,placeholder:e.placeholder,className:"w-full p-4 rounded-xl border border-zinc-200 bg-zinc-50 focus:bg-white focus:ring-2 focus:ring-zinc-900 focus:outline-none transition-all text-zinc-900 shadow-sm dark:bg-zinc-900 dark:border-zinc-800 dark:text-zinc-50 dark:focus:ring-zinc-100 dark:focus:bg-zinc-900 resize-none hover:border-zinc-300 dark:hover:border-zinc-700 text-base"})]})]},e.key))]})]})})}},{id:"3",label:"3. 構造設計",component:({project:e,onUpdate:r})=>{let[i,n]=(0,s.useState)(e.structureBoard||[]),[a,l]=(0,s.useState)(e.structureBeats||{tp1:"",midpoint:"",tp2:""}),[d,o]=(0,s.useState)(null);(0,s.useEffect)(()=>{n(e.structureBoard||[]),e.structureBeats&&l(e.structureBeats)},[e.structureBoard,e.structureBeats]);let u=(e,t)=>{let s={...a,[e]:t};l(s),r({structureBeats:s})},h=(0,m.useSensors)((0,m.useSensor)(m.PointerSensor,{activationConstraint:{distance:8,delay:100}}),(0,m.useSensor)(m.KeyboardSensor,{coordinateGetter:p.sortableKeyboardCoordinates})),f=(e,t)=>{let s=i.map(s=>s.id===e?{...s,...t}:s);n(s),r({structureBoard:s})},b=e=>{let t=i.filter(t=>t.id!==e);n(t),r({structureBoard:t})};return(0,t.jsx)(m.DndContext,{sensors:h,collisionDetection:m.closestCenter,onDragStart:e=>{o(e.active.id)},onDragOver:e=>{let{active:t,over:s}=e;if(!s)return;let r=t.id,a=s.id,l=i.find(e=>e.id===r),c=i.find(e=>e.id===a);if(l){if(["1","2","3"].includes(a)){l.act!==a&&n(e=>{let t=[...e],s=t.findIndex(e=>e.id===r);return t[s].act=a,t});return}c&&l.act!==c.act&&n(e=>{let t=[...e],s=t.findIndex(e=>e.id===r);return t[s].act=c.act,(0,p.arrayMove)(t,s,t.indexOf(c))})}},onDragEnd:e=>{let{active:t,over:s}=e;if(o(null),!s)return;let a=t.id,l=s.id;s.data.current?.sortable?.containerId||s.id;let c=[...i],d=c.findIndex(e=>e.id===a);if(a!==l){let e=c.findIndex(e=>e.id===l);-1!==e&&((c=(0,p.arrayMove)(c,d,e))[d].act=c[e].act)}r({structureBoard:c}),n(c)},children:(0,t.jsxs)("div",{className:"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500",children:[(0,t.jsx)("div",{className:"flex items-center justify-between",children:(0,t.jsxs)("h2",{className:"text-xl font-bold flex items-center gap-2 text-zinc-900 dark:text-zinc-50",children:[(0,t.jsx)("span",{className:"flex items-center justify-center w-8 h-8 rounded-full bg-zinc-900 text-zinc-50 text-sm dark:bg-zinc-100 dark:text-zinc-900",children:"3"}),"構造設計 (三幕構成)"]})}),(0,t.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 md:h-[calc(100vh-200px)] min-h-[500px]",children:["1","2","3"].map(e=>(0,t.jsxs)("div",{className:"flex flex-col h-full bg-zinc-50 rounded-xl border border-zinc-200 dark:bg-zinc-900/50 dark:border-zinc-800",children:[(0,t.jsxs)("div",{className:"p-4 border-b border-zinc-200 dark:border-zinc-800 bg-zinc-100/50 dark:bg-zinc-900 rounded-t-xl",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,t.jsx)("h3",{className:"font-bold text-zinc-900 dark:text-zinc-50",children:"1"===e?"第一幕: 状況設定・問題提起":"2"===e?"第二幕: 対立・葛藤":"第三幕: 解決"}),(0,t.jsx)("span",{className:"text-sm font-black font-mono text-zinc-400 bg-zinc-200/50 px-2 py-0.5 rounded dark:bg-zinc-800",children:"1"===e?"SETUP":"2"===e?"CONFRONTATION":"RESOLUTION"})]}),(0,t.jsxs)("div",{className:"text-sm leading-relaxed text-zinc-600 font-medium",children:["1"===e&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("p",{className:"mb-0.5",children:"物語の舞台は？"}),(0,t.jsx)("p",{children:"主人公が解決しなければいけない問題は？"})]}),"2"===e&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("p",{className:"mb-0.5",children:"主人公が挑戦・失敗・悩む姿は？"}),(0,t.jsx)("p",{children:"どんな敵や障害が現れる？"})]}),"3"===e&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("p",{className:"mb-0.5",children:"第一幕で提示した問題の答えは？"}),(0,t.jsx)("p",{children:"主人公はどう変わった？"})]})]})]}),(0,t.jsx)(p.SortableContext,{id:e,items:i.filter(t=>t.act===e).map(e=>e.id),strategy:p.verticalListSortingStrategy,children:(0,t.jsxs)("div",{className:"flex-1 p-4 overflow-y-auto space-y-3 min-h-[100px]",children:[i.filter(t=>t.act===e).map(e=>(0,t.jsx)(g,{card:e,onDelete:b,onUpdate:f},e.id)),(0,t.jsxs)(c.Button,{variant:"outline",size:"sm",className:"w-full border-dashed text-zinc-400 hover:text-zinc-600 dark:border-zinc-800 dark:hover:text-zinc-300",onClick:()=>{let t;n(t=[...i,{id:crypto.randomUUID(),content:"",act:e,tags:[]}]),r({structureBoard:t})},children:[(0,t.jsx)(x.Plus,{size:14,className:"mr-1"})," カード追加"]})]})}),(0,t.jsxs)("div",{className:"p-4 pt-0 border-t border-zinc-200 dark:border-zinc-800 bg-zinc-50/50 dark:bg-zinc-900/30 rounded-b-xl space-y-3",children:["1"===e&&(0,t.jsxs)("div",{className:"mt-3",children:[(0,t.jsx)("label",{className:"text-sm font-black text-rose-500 uppercase tracking-widest mb-1.5 block",children:"ターニングポイント 1 (TP1)"}),(0,t.jsx)("textarea",{value:a.tp1,onChange:e=>u("tp1",e.target.value),placeholder:"物語が大きく動き出す瞬間...",rows:2,className:"w-full text-sm p-2.5 rounded-lg border border-zinc-200 bg-white shadow-sm focus:outline-none focus:ring-1 focus:ring-rose-500 dark:bg-zinc-950 dark:border-zinc-800 dark:text-white"})]}),"2"===e&&(0,t.jsxs)("div",{className:"mt-3 space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-sm font-black text-amber-500 uppercase tracking-widest mb-1.5 block",children:"中間点 (MP)"}),(0,t.jsx)("textarea",{value:a.midpoint,onChange:e=>u("midpoint",e.target.value),placeholder:"物語の折り返し地点...",rows:2,className:"w-full text-sm p-2.5 rounded-lg border border-zinc-200 bg-white shadow-sm focus:outline-none focus:ring-1 focus:ring-amber-500 dark:bg-zinc-950 dark:border-zinc-800 dark:text-white"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-sm font-black text-rose-600 uppercase tracking-widest mb-1.5 block",children:"ターニングポイント 2 (TP2)"}),(0,t.jsx)("textarea",{value:a.tp2,onChange:e=>u("tp2",e.target.value),placeholder:"クライマックスへの突入...",rows:2,className:"w-full text-sm p-2.5 rounded-lg border border-zinc-200 bg-white shadow-sm focus:outline-none focus:ring-1 focus:ring-rose-600 dark:bg-zinc-950 dark:border-zinc-800 dark:text-white"})]})]}),"3"===e&&(0,t.jsx)("div",{className:"py-2 text-center",children:(0,t.jsx)("div",{className:"text-sm font-black text-zinc-400 uppercase tracking-widest",children:"Fin."})})]})]},e))}),(0,t.jsx)(m.DragOverlay,{dropAnimation:{sideEffects:(0,m.defaultDropAnimationSideEffects)({styles:{active:{opacity:"0.5"}}})},children:d?(0,t.jsx)(g,{card:i.find(e=>e.id===d),isOverlay:!0}):null})]})})}},{id:"4",label:"4. キャラクター選択",component:({project:e,onUpdate:i})=>{let{characters:n,addCharacter:a}=(0,j.useCharacters)(),[l,d]=(0,s.useState)(!1),[o,h]=(0,s.useState)(""),m=e.linkedCharacterIds||[],p=n.filter(e=>m.includes(e.id)),f=e.characters||[],b=e=>{i({linkedCharacterIds:m.includes(e)?m.filter(t=>t!==e):[...m,e]})};return(0,t.jsxs)("div",{className:"space-y-8 animate-in fade-in slide-in-from-bottom-4 duration-500",children:[(0,t.jsxs)("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("h2",{className:"text-xl font-bold flex items-center gap-2 text-white",children:[(0,t.jsx)("span",{className:"flex items-center justify-center w-8 h-8 rounded-full bg-white text-zinc-900 text-sm",children:"4"}),"キャラクター選択"]}),(0,t.jsx)("p",{className:"text-sm text-zinc-500 mt-1",children:"この作品に登場させるキャラクターを名簿から選択します。"})]}),(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row gap-2 w-full md:w-auto",children:[(0,t.jsx)(r.default,{href:"/characters",className:"w-full md:w-auto",children:(0,t.jsxs)(c.Button,{variant:"ghost",className:"w-full md:w-auto text-zinc-400 hover:text-white font-bold border border-zinc-800",children:[(0,t.jsx)(k,{className:"w-4 h-4 mr-2"})," 名簿の編集"]})}),(0,t.jsxs)(c.Button,{onClick:()=>d(!l),className:"w-full md:w-auto font-bold bg-white text-zinc-900 hover:bg-zinc-200",children:[(0,t.jsx)(x.Plus,{className:"w-4 h-4 mr-2"})," キャラクターを参加させる"]})]})]}),l&&(0,t.jsxs)("div",{className:"bg-[#0a0a0a] border border-zinc-800 rounded-2xl p-6 space-y-4 animate-in zoom-in-95 duration-200 shadow-2xl",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("h3",{className:"font-bold text-sm text-zinc-400 uppercase tracking-widest",children:"グローバル名簿から選択"}),(0,t.jsx)("button",{onClick:()=>d(!1),className:"text-zinc-600 hover:text-white transition-colors",children:(0,t.jsx)(u.X,{size:18})})]}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(y.Search,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-zinc-600"}),(0,t.jsx)("input",{type:"text",placeholder:"名前で検索、または新規作成して追加...",value:o,onChange:e=>h(e.target.value),className:"w-full bg-zinc-900/50 border border-zinc-800 rounded-xl pl-10 pr-4 h-12 text-base focus:outline-none focus:ring-1 focus:ring-zinc-700"})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 lg:grid-cols-3 gap-3 max-h-[400px] overflow-y-auto pr-2 scrollbar-hide",children:[n.filter(e=>e.name.toLowerCase().includes(o.toLowerCase())).map(e=>(0,t.jsxs)("button",{onClick:()=>b(e.id),className:`flex items-center gap-3 p-3 rounded-xl border transition-all text-left group ${m.includes(e.id)?"bg-white border-white text-black":"bg-zinc-900/50 border-zinc-800 text-zinc-500 hover:border-zinc-600 hover:text-zinc-300"}`,children:[(0,t.jsx)("div",{className:"w-10 h-10 rounded-full bg-black/20 border border-zinc-700/30 overflow-hidden shrink-0",children:e.icon?(0,t.jsx)("img",{src:e.icon,alt:e.name,className:"w-full h-full object-cover"}):(0,t.jsx)("div",{className:"w-full h-full flex items-center justify-center",children:(0,t.jsx)(v.User,{size:16})})}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsx)("div",{className:"font-bold text-sm truncate",children:e.name}),(0,t.jsx)("div",{className:"text-sm opacity-60 truncate",children:m.includes(e.id)?"参戦中":"待機中"})]}),(0,t.jsx)("div",{className:`p-1 rounded-full ${m.includes(e.id)?"bg-black text-white":"bg-transparent text-transparent group-hover:bg-zinc-800"}`,children:(0,t.jsx)(w.Check,{size:12})})]},e.id)),o&&!n.find(e=>e.name.toLowerCase()===o.toLowerCase())&&(0,t.jsxs)("button",{onClick:()=>{b(a({name:o||"新しいキャラクター",description:""}).id),h("")},className:"flex items-center gap-3 p-3 rounded-xl border border-dashed border-zinc-800 text-zinc-500 hover:border-zinc-600 hover:text-white transition-all text-left",children:[(0,t.jsx)("div",{className:"w-10 h-10 rounded-full bg-zinc-900 border border-zinc-800 flex items-center justify-center shrink-0 text-zinc-700",children:(0,t.jsx)(x.Plus,{size:16})}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsxs)("div",{className:"font-bold text-sm truncate text-zinc-300",children:["「",o,"」を登録"]}),(0,t.jsx)("div",{className:"text-sm",children:"名簿へ追加してこの作品にリンク"})]})]})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[p.map(e=>(0,t.jsxs)("div",{className:"bg-[#192a31] rounded-2xl border border-zinc-800 p-6 flex gap-6 relative group transform transition-all hover:scale-[1.01] hover:border-zinc-600 shadow-xl",children:[(0,t.jsxs)("div",{className:"relative shrink-0",children:[(0,t.jsx)("div",{className:"w-20 h-20 rounded-full bg-black border-2 border-zinc-800 overflow-hidden",children:e.icon?(0,t.jsx)("img",{src:e.icon,alt:e.name,className:"w-full h-full object-cover"}):(0,t.jsx)("div",{className:"w-full h-full flex items-center justify-center text-zinc-800",children:(0,t.jsx)(v.User,{size:32})})}),(0,t.jsx)("div",{className:"absolute -bottom-1 -right-1 w-7 h-7 bg-white text-black rounded-full flex items-center justify-center border-4 border-[#192a31]",children:(0,t.jsx)(N,{size:12})})]}),(0,t.jsxs)("div",{className:"flex-1 space-y-1",children:[(0,t.jsx)("div",{className:"text-xl font-bold text-white",children:e.name}),(0,t.jsx)("div",{className:"text-sm text-zinc-500 leading-relaxed line-clamp-2",children:e.description||"（説明なし）"}),(0,t.jsx)("span",{className:"text-sm font-black uppercase tracking-widest px-2 py-0.5 rounded bg-zinc-900 border border-zinc-800 text-zinc-400",children:"リンク中"},e.id+"-link")]}),(0,t.jsxs)("button",{onClick:()=>b(e.id),className:"absolute top-4 right-4 p-2 text-zinc-600 hover:text-red-500 opacity-0 group-hover:opacity-100 transition-all font-bold text-sm flex items-center gap-1",children:[(0,t.jsx)(z.Trash2,{size:14})," 除外"]})]},e.id)),f.map(e=>(0,t.jsxs)("div",{className:"bg-[#192a31]/50 border-2 border-dashed border-zinc-800 rounded-2xl p-6 flex gap-6 relative group opacity-60 grayscale hover:grayscale-0 hover:opacity-100 transition-all",children:[(0,t.jsx)("div",{className:"w-20 h-20 rounded-full bg-zinc-900 border border-zinc-800 overflow-hidden flex items-center justify-center text-zinc-700",children:e.icon?(0,t.jsx)("img",{src:e.icon,alt:e.name,className:"w-full h-full object-cover"}):(0,t.jsx)(v.User,{size:32})}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("div",{className:"font-bold text-white",children:e.name}),(0,t.jsx)("div",{className:"text-sm text-zinc-600",children:"プロジェクト固有（レガシー）"})]})]},e.id)),0===p.length&&0===f.length&&(0,t.jsxs)("div",{className:"md:col-span-2 py-20 flex flex-col items-center justify-center border-2 border-dashed border-[#192a31] bg-[#192a31]/40 rounded-3xl",children:[(0,t.jsx)(v.User,{className:"w-12 h-12 text-zinc-800 mb-4"}),(0,t.jsx)("p",{className:"text-zinc-700 font-bold uppercase tracking-widest text-sm",children:"登場キャラクターが未選択です"}),(0,t.jsx)(c.Button,{onClick:()=>d(!0),variant:"ghost",className:"mt-4 text-zinc-500 hover:text-white",children:"名簿から選択する"})]})]})]})}},{id:"5",label:"5. ネーム制作",component:({project:e,episode:r,onUpdate:i})=>{let{characters:n,groups:a}=(0,j.useCharacters)(),l=r.linkedCharacterIds||[],d=Array.from(new Map([...n.filter(e=>l.includes(e.id)),...e.characters||[]].map(e=>[e.id,e])).values()),[o,x]=(0,s.useState)(r.structureBoard||[]),[u,h]=(0,s.useState)(null),[f,b]=(0,s.useState)(null),[g,v]=(0,s.useState)({isOpen:!1,panel:null,groupId:""});(0,s.useEffect)(()=>{x(r.structureBoard||[])},[r.structureBoard]);let z=(0,m.useSensors)((0,m.useSensor)(m.PointerSensor,{activationConstraint:{distance:8,delay:100}}),(0,m.useSensor)(m.KeyboardSensor,{coordinateGetter:p.sortableKeyboardCoordinates})),y=(e,t)=>{v({isOpen:!0,panel:e,groupId:t})},w=e=>{let t={id:crypto.randomUUID(),drawing:"",dialogues:[]},s=o.map(s=>s.id===e?{...s,scenes:[...s.scenes||[],t]}:s);x(s),i({structureBoard:s})},N=async(e,t,s)=>{let r=o.map(r=>r.id===e?{...r,scenes:(r.scenes||[]).map(e=>e.id===t?{...e,...s}:e)}:r);x(r),i({structureBoard:r})},k=(e,t)=>{let s=o.map(s=>s.id===e?{...s,scenes:(s.scenes||[]).filter(e=>e.id!==t)}:s);x(s),i({structureBoard:s})},S=(e,t)=>{let s={id:crypto.randomUUID(),character:"",text:"",memo:""},r=o.map(r=>r.id===e?{...r,scenes:(r.scenes||[]).map(e=>e.id===t?{...e,dialogues:[...e.dialogues||[],s]}:e)}:r);x(r),i({structureBoard:r})},_=(e,t,s,r)=>{let n=o.map(i=>i.id===e?{...i,scenes:(i.scenes||[]).map(e=>e.id===t?{...e,dialogues:(e.dialogues||[]).map(e=>e.id===s?{...e,...r}:e)}:e)}:i);x(n),i({structureBoard:n})},I=(e,t,s)=>{let r=o.map(r=>r.id===e?{...r,scenes:(r.scenes||[]).map(e=>e.id===t?{...e,dialogues:(e.dialogues||[]).filter(e=>e.id!==s)}:e)}:r);x(r),i({structureBoard:r})},R=o.flatMap(e=>e.scenes||[]).find(e=>e.id===u);return(0,t.jsxs)("div",{className:"space-y-12 animate-in fade-in slide-in-from-bottom-4 duration-500 pb-20",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("h2",{className:"text-2xl font-black flex items-center gap-3 text-white",children:[(0,t.jsx)("span",{className:"flex items-center justify-center w-8 h-8 rounded-full bg-white text-zinc-900 text-sm",children:"5"}),"ネーム制作 (下書き)"]}),(0,t.jsx)("p",{className:"text-zinc-500 text-sm mt-2 font-medium tracking-wide",children:"エピソードをコマ（パネル）に落とし込み、セリフや演出を細かく構築します。"})]}),(0,t.jsxs)(m.DndContext,{sensors:z,collisionDetection:m.closestCenter,onDragStart:e=>{let{active:t}=e;h(t.id),b(t.data.current?.type)},onDragOver:e=>{let{active:t,over:s}=e;if(!s||t.id===s.id)return;let r=t.data.current,i=s.data.current;if(r?.type==="dialogue"){let e=r.panelId,n="";i?.type==="dialogue"||i?.type==="dialogue-container"?n=i.panelId:i?.type==="panel"&&(n=s.id),n&&e!==n&&(x(r=>{let i,a=JSON.parse(JSON.stringify(r));return a.forEach(s=>{s.scenes?.forEach(s=>{if(s.id===e){let e=s.dialogues?.findIndex(e=>e.id===t.id);-1!==e&&(i=s.dialogues[e],s.dialogues.splice(e,1))}})}),i&&a.forEach(e=>{e.scenes?.forEach(e=>{if(e.id===n){e.dialogues=e.dialogues||[];let t=e.dialogues.findIndex(e=>e.id===s.id);t>=0?e.dialogues.splice(t,0,i):e.dialogues.push(i)}})}),a}),t.data.current.panelId=n)}else if(r?.type==="panel"){let e=r.parentId,n=i?.type==="panel"?i.parentId:s.id;e!==n&&(x(r=>{let i,a=JSON.parse(JSON.stringify(r));return a.forEach(s=>{s.id===e&&(i=s.scenes?.find(e=>e.id===t.id),s.scenes=s.scenes?.filter(e=>e.id!==t.id))}),i&&a.forEach(e=>{if(e.id===n){let t=[...e.scenes||[]],r=t.findIndex(e=>e.id===s.id);r>=0?t.splice(r,0,i):t.push(i),e.scenes=t}}),a}),t.data.current.parentId=n)}},onDragEnd:e=>{let{active:t,over:s}=e;if(h(null),b(null),s){if(t.id!==s.id){let e=t.data.current,r=s.data.current;if(e?.type==="dialogue"){let e="";o.forEach(s=>s.scenes?.forEach(s=>{s.dialogues?.some(e=>e.id===t.id)&&(e=s.id)}));let i=r?.panelId||(r?.type==="panel"?s.id:null);e&&e===i&&x(r=>r.map(r=>({...r,scenes:(r.scenes||[]).map(r=>{if(r.id===e){let e=r.dialogues?.findIndex(e=>e.id===t.id)??-1,i=r.dialogues?.findIndex(e=>e.id===s.id)??-1;if(-1!==e&&-1!==i)return{...r,dialogues:(0,p.arrayMove)(r.dialogues,e,i)}}return r})})))}else if(e?.type==="panel"){let e="";o.forEach(s=>{s.scenes?.some(e=>e.id===t.id)&&(e=s.id)});let i=r?.parentId||(r?.type==="container"?s.id:null);e&&e===i&&x(r=>r.map(r=>{if(r.id===e){let e=r.scenes||[],i=e.findIndex(e=>e.id===t.id)??-1,n=e.findIndex(e=>e.id===s.id)??-1;if(-1!==i&&-1!==n)return{...r,scenes:(0,p.arrayMove)(e,i,n)}}return r}))}}i({structureBoard:o})}},children:[(0,t.jsx)("div",{className:"space-y-20",children:0===o.length?(0,t.jsxs)("div",{className:"py-20 flex flex-col items-center justify-center border-2 border-dashed border-zinc-800 rounded-3xl bg-white/5",children:[(0,t.jsx)(C,{size:48,className:"text-zinc-500 mb-4"}),(0,t.jsx)("p",{className:"text-zinc-300 font-bold mb-2",children:"構成データが見つかりません"}),(0,t.jsxs)("p",{className:"text-zinc-400 text-sm text-center leading-relaxed",children:['Step 3 "構成・構成案" でエピソードの構成を作成してください。',(0,t.jsx)("br",{}),"または、データが読み込まれていない可能性があります。"]}),(0,t.jsx)(c.Button,{variant:"outline",size:"sm",onClick:()=>window.location.reload(),className:"mt-6 text-sm border-zinc-700 text-zinc-300 hover:text-white hover:bg-zinc-800",children:"ページをリロード"})]}):o.map(e=>(0,t.jsx)(M,{group:e,activeId:u,activeType:f,characters:d,groups:a,onAddItem:w,onUpdateItem:N,onDeleteItem:k,onAddDialogue:S,onUpdateDialogue:_,onDeleteDialogue:I,onOpenModal:y},e.id))}),(0,t.jsx)(m.DragOverlay,{dropAnimation:{sideEffects:(0,m.defaultDropAnimationSideEffects)({styles:{active:{opacity:"0.4"}}})},children:u&&"panel"===f&&R?(0,t.jsx)("div",{className:"w-[800px] shadow-[0_0_50px_rgba(255,255,255,0.1)]",children:(0,t.jsx)(F,{item:R,parentId:((e,t)=>{if("panel"===t)return o.find(t=>t.id===e||t.scenes?.some(t=>t.id===e))?.id;for(let t of o)for(let s of t.scenes||[])if(s.dialogues?.some(t=>t.id===e))return t.id;return null})(u,"panel"),activeId:null,activeType:null,characters:d,groups:a,onUpdateItem:N,onDeleteItem:k,onAddDialogue:S,onUpdateDialogue:_,onDeleteDialogue:I,onOpenModal:y})}):null})]}),g.isOpen&&g.panel&&(0,t.jsx)(E,{isOpen:g.isOpen,onClose:()=>v(e=>({...e,isOpen:!1})),initialData:g.panel.drawing,onSave:e=>{g.panel&&(N(g.groupId,g.panel.id,{drawing:e}),v(t=>({...t,panel:{...t.panel,drawing:e}})))}})]})}},{id:"6",label:"6. 企画書出力",component:({project:e})=>{let{characters:s,groups:r}=(0,j.useCharacters)(),i=(e.linkedCharacterIds||[]).map(e=>s.find(t=>t.id===e)).filter(e=>!!e),n=i.length>0?i:e.characters||[],a=(e.structureBoard||[]).flatMap(e=>(e.scenes||[]).map(t=>({...t,groupTitle:e.content,groupTags:e.tags})));return(0,t.jsxs)("div",{className:"max-w-4xl mx-auto space-y-8 animate-in fade-in slide-in-from-bottom-4 duration-500",children:[(0,t.jsxs)("div",{className:"bg-zinc-100 dark:bg-zinc-900 p-4 rounded-xl border border-zinc-200 dark:border-zinc-800 flex flex-col md:flex-row items-center justify-between gap-4 print:hidden",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("h2",{className:"text-xl font-bold flex items-center gap-2 text-zinc-900 dark:text-zinc-50",children:[(0,t.jsx)("span",{className:"flex items-center justify-center w-8 h-8 rounded-full bg-zinc-900 text-zinc-50 text-sm dark:bg-zinc-100 dark:text-zinc-900",children:"6"}),"企画書出力"]}),(0,t.jsx)("p",{className:"text-zinc-500 dark:text-zinc-400 text-sm",children:"下のボタンを押すと、このページを印刷またはPDFとして保存できます。"})]}),(0,t.jsxs)(c.Button,{onClick:()=>{window.print()},className:"font-bold px-6 rounded-full shadow-lg",children:[(0,t.jsx)(P,{size:18,className:"mr-2"}),"印刷 / PDF保存"]})]}),(0,t.jsxs)("div",{className:"jsx-487bc265117af5a6 print-container bg-white text-black p-8 md:p-16 rounded-sm shadow-2xl min-h-[297mm] relative overflow-hidden",children:[(0,t.jsx)(O.default,{id:"487bc265117af5a6",children:"@media print{@page{size:A4;margin:0}body{background:#fff}aside,header,nav,.print\\:hidden{display:none!important}main{width:100%!important;max-width:none!important;margin:0!important;padding:0!important}.print-container{width:100%;box-shadow:none;visibility:visible;border:none;margin:0;padding:20mm;position:absolute;top:0;left:0}.page-break{page-break-before:always}.keep-together{break-inside:avoid}}"}),(0,t.jsxs)("section",{className:"jsx-487bc265117af5a6 mb-16 border-b-4 border-black pb-8",children:[(0,t.jsx)("div",{className:"jsx-487bc265117af5a6 text-sm font-bold tracking-widest text-zinc-500 uppercase mb-2",children:"Project Proposal"}),(0,t.jsx)("h1",{className:"jsx-487bc265117af5a6 text-5xl font-black mb-6 leading-tight",children:e.title||"無題のプロジェクト"}),(0,t.jsx)("p",{className:"jsx-487bc265117af5a6 text-xl font-medium leading-relaxed text-zinc-700 whitespace-pre-wrap",children:e.description||"ログライン（一行あらすじ）が入力されていません。"}),(0,t.jsx)("div",{className:"jsx-487bc265117af5a6 mt-8 flex gap-4 text-sm text-zinc-500",children:(0,t.jsxs)("span",{className:"jsx-487bc265117af5a6",children:["最終更新: ",new Date(e.lastEdited).toLocaleDateString()]})})]}),(0,t.jsxs)("section",{className:"jsx-487bc265117af5a6 mb-12 keep-together",children:[(0,t.jsxs)("h3",{className:"jsx-487bc265117af5a6 text-2xl font-bold border-l-8 border-black pl-4 mb-6 flex items-center gap-2",children:[(0,t.jsx)(A.BookOpen,{size:24})," 企画コンセプト"]}),(0,t.jsxs)("div",{className:"jsx-487bc265117af5a6 grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,t.jsxs)("div",{className:"jsx-487bc265117af5a6 bg-zinc-50 p-6 rounded-lg border border-zinc-100",children:[(0,t.jsx)("h4",{className:"jsx-487bc265117af5a6 font-bold text-zinc-400 text-sm uppercase mb-2",children:"テーマ (Theme)"}),(0,t.jsx)("p",{className:"jsx-487bc265117af5a6 text-lg font-serif font-bold",children:e.concept?.theme||"-"})]}),(0,t.jsxs)("div",{className:"jsx-487bc265117af5a6 bg-zinc-50 p-6 rounded-lg border border-zinc-100",children:[(0,t.jsx)("h4",{className:"jsx-487bc265117af5a6 font-bold text-zinc-400 text-sm uppercase mb-2",children:"読後感 (Emotion)"}),(0,t.jsx)("p",{className:"jsx-487bc265117af5a6 text-lg",children:e.concept?.emotions||"-"})]})]})]}),(0,t.jsxs)("section",{className:"jsx-487bc265117af5a6 mb-12",children:[(0,t.jsxs)("h3",{className:"jsx-487bc265117af5a6 text-2xl font-bold border-l-8 border-black pl-4 mb-6 flex items-center gap-2",children:[(0,t.jsx)(v.User,{size:24})," 主要キャラクター"]}),(0,t.jsx)("div",{className:"jsx-487bc265117af5a6 grid grid-cols-1 gap-6",children:n.length>0?n.map(e=>(0,t.jsxs)("div",{className:"jsx-487bc265117af5a6 flex gap-6 p-4 border border-zinc-200 rounded-xl items-start keep-together",children:[(0,t.jsx)("div",{className:"jsx-487bc265117af5a6 w-20 h-20 bg-zinc-100 rounded-full shrink-0 overflow-hidden border border-zinc-200",children:e.icon?(0,t.jsx)("img",{src:e.icon,alt:e.name,className:"jsx-487bc265117af5a6 w-full h-full object-cover grayscale"}):(0,t.jsx)("div",{className:"jsx-487bc265117af5a6 w-full h-full flex items-center justify-center text-zinc-300",children:(0,t.jsx)(v.User,{size:32})})}),(0,t.jsxs)("div",{className:"jsx-487bc265117af5a6 flex-1",children:[(0,t.jsx)("div",{className:"jsx-487bc265117af5a6 flex items-center gap-2 mb-1",children:(0,t.jsx)("h4",{className:"jsx-487bc265117af5a6 text-lg font-bold",children:e.name})}),(0,t.jsx)("p",{className:"jsx-487bc265117af5a6 text-sm text-zinc-700 whitespace-pre-wrap leading-relaxed",children:e.description||"詳細設定なし"})]})]},e.id)):(0,t.jsx)("p",{className:"jsx-487bc265117af5a6 text-zinc-400 italic",children:"キャラクターが登録されていません。"})})]}),(0,t.jsx)("div",{className:"jsx-487bc265117af5a6 page-break"}),(0,t.jsxs)("section",{className:"jsx-487bc265117af5a6 mb-12 mt-8",children:[(0,t.jsxs)("h3",{className:"jsx-487bc265117af5a6 text-2xl font-bold border-l-8 border-black pl-4 mb-6 flex items-center gap-2",children:[(0,t.jsx)(U,{size:24})," ストーリーライン"]}),(0,t.jsxs)("div",{className:"jsx-487bc265117af5a6 grid grid-cols-2 gap-4 mb-8",children:[(0,t.jsxs)("div",{className:"jsx-487bc265117af5a6 p-4 bg-zinc-50 border-l-4 border-zinc-300",children:[(0,t.jsx)("span",{className:"jsx-487bc265117af5a6 block text-sm font-bold text-zinc-400 mb-1",children:"START"}),(0,t.jsx)("p",{className:"jsx-487bc265117af5a6 font-medium text-sm",children:e.outline?.start||"-"})]}),(0,t.jsxs)("div",{className:"jsx-487bc265117af5a6 p-4 bg-zinc-50 border-l-4 border-zinc-300",children:[(0,t.jsx)("span",{className:"jsx-487bc265117af5a6 block text-sm font-bold text-zinc-400 mb-1",children:"GOAL"}),(0,t.jsx)("p",{className:"jsx-487bc265117af5a6 font-medium text-sm",children:e.outline?.end||"-"})]})]}),(0,t.jsxs)("div",{className:"jsx-487bc265117af5a6 space-y-4",children:[(0,t.jsx)("h4",{className:"jsx-487bc265117af5a6 font-bold text-lg mb-4 border-b border-zinc-200 pb-2",children:"シーン構成 (ネーム)"}),a.length>0?a.map((e,s)=>(0,t.jsxs)("div",{className:"jsx-487bc265117af5a6 flex gap-4 items-baseline border-b border-zinc-100 pb-3 keep-together",children:[(0,t.jsxs)("span",{className:"jsx-487bc265117af5a6 font-mono text-zinc-400 w-8 shrink-0 text-right",children:["#",s+1]}),(0,t.jsxs)("div",{className:"jsx-487bc265117af5a6 flex-1",children:[(0,t.jsxs)("div",{className:"jsx-487bc265117af5a6 mb-1 flex items-center gap-2",children:[(0,t.jsx)("span",{className:"jsx-487bc265117af5a6 font-bold text-sm text-zinc-500 uppercase",children:e.groupTitle}),e.groupTags&&e.groupTags.length>0&&(0,t.jsx)("div",{className:"jsx-487bc265117af5a6 flex gap-1",children:e.groupTags.map(e=>(0,t.jsx)("span",{className:`jsx-487bc265117af5a6 px-1.5 py-0.5 text-sm rounded border font-bold bg-white ${b[e]?.color} border-zinc-300`,children:b[e]?.label},e))})]}),e.drawing&&(0,t.jsx)("div",{className:"jsx-487bc265117af5a6 mb-2 w-32 h-20 border border-zinc-200 bg-zinc-50 overflow-hidden",children:(0,t.jsx)("img",{src:e.drawing,className:"jsx-487bc265117af5a6 w-full h-full object-contain"})}),(0,t.jsx)("div",{className:"jsx-487bc265117af5a6 space-y-1",children:e.dialogues?.map((e,s)=>{let r=n.find(t=>t.id===e.characterId);return(0,t.jsxs)("div",{className:"jsx-487bc265117af5a6 text-sm flex gap-2",children:[(0,t.jsx)("span",{className:"jsx-487bc265117af5a6 font-bold text-zinc-600 shrink-0 text-sm w-16 truncate",children:r?.name||e.character||"???"}),(0,t.jsxs)("span",{className:"jsx-487bc265117af5a6 text-zinc-800",children:["「",e.text,"」"]})]},s)})})]})]},e.id)):(0,t.jsx)("p",{className:"jsx-487bc265117af5a6 text-zinc-400 italic",children:"シーンが作成されていません。"})]})]}),(0,t.jsxs)("div",{className:"jsx-487bc265117af5a6 mt-20 pt-8 border-t border-zinc-200 text-center text-zinc-400 text-sm flex justify-between items-center",children:[(0,t.jsx)("span",{className:"jsx-487bc265117af5a6",children:"Generated by Manga Support App"}),(0,t.jsxs)("span",{className:"jsx-487bc265117af5a6",children:[new Date().toLocaleDateString()," 出力"]})]})]})]})}}];function q({projectId:e,episodeId:i}){let{project:x,episode:u,loading:h,updateEpisode:m}=((e,t)=>{let{project:r,loading:i,updateProject:n}=(0,d.useProject)(e),[a,l]=(0,s.useState)(null),[c,o]=(0,s.useState)(!0),x=(0,s.useRef)(null);return(0,s.useEffect)(()=>{i||(r?l(r.episodes?.find(e=>e.id===t)||null):l(null),o(!1))},[r,t,i]),{project:r,episode:a,loading:c||i,updateEpisode:s=>{if(!r||!a)return;let i={...a,...s,lastEdited:new Date().toISOString()};l(i),n({episodes:r.episodes?.map(e=>e.id===t?i:e)||[]},{localOnly:!0}),x.current&&clearTimeout(x.current),x.current=setTimeout(async()=>{try{await fetch(`/api/projects/${e}/episodes/${t}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)})}catch(e){console.error("Episode auto-save failed",e)}},1e3)}}})(e,i),[p,f]=(0,s.useState)("1"),[b,g]=(0,s.useState)(!1);if(h)return(0,t.jsx)("div",{className:"p-10 text-center text-zinc-500",children:"Loading..."});if(!x)return(0,t.jsx)("div",{className:"p-10 text-center text-zinc-500",children:"Project Not Found"});if(!u)return(0,t.jsx)("div",{className:"p-10 text-center text-zinc-500",children:"Episode Not Found"});let j=L.find(e=>e.id===p)?.component||o,v={...x,...u,id:x.id},z=()=>(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"p-6 border-b border-zinc-800",children:[(0,t.jsxs)(r.default,{href:`/projects/${e}`,className:"flex items-center text-xs text-zinc-400 hover:text-white mb-4 transition-colors",children:[(0,t.jsx)(a.ArrowLeft,{className:"w-3 h-3 mr-1"}),"シリーズ詳細へ戻る"]}),(0,t.jsx)("h1",{className:"font-bold text-sm text-zinc-400 mb-1 truncate",children:x.title}),(0,t.jsx)("h2",{className:"font-bold text-xl text-white truncate",children:u.title})]}),(0,t.jsxs)("nav",{className:"flex-1 p-4 space-y-1 overflow-y-auto",children:[(0,t.jsx)("div",{className:"text-[10px] font-black text-zinc-500 uppercase tracking-widest px-4 mb-2",children:"制作ステップ"}),L.map(e=>(0,t.jsxs)(c.Button,{onClick:()=>{f(e.id),g(!1)},variant:p===e.id?"default":"ghost",className:`w-full justify-start text-left overflow-hidden ${p===e.id?"font-bold bg-[#0077BE] text-white hover:bg-[#0077BE]/90":"text-zinc-400 hover:text-white hover:bg-zinc-800"}`,children:[(0,t.jsx)("span",{className:"flex-1 truncate",children:e.label}),p===e.id&&(0,t.jsx)(n,{className:"w-4 h-4 opacity-100 flex-shrink-0 ml-2"})]},e.id))]}),(0,t.jsx)("div",{className:"p-4 border-t border-zinc-800 mt-auto",children:(0,t.jsx)($.UserMenu,{showName:!0})})]});return(0,t.jsxs)("div",{className:"flex bg-zinc-50 min-h-screen dark:bg-zinc-950",children:[(0,t.jsx)("aside",{className:"w-64 fixed h-full bg-[#253341] border-r border-zinc-800 z-30 hidden md:flex flex-col",children:(0,t.jsx)(z,{})}),b&&(0,t.jsx)("div",{className:"md:hidden fixed inset-0 bg-black/50 z-40 transition-opacity",onClick:()=>g(!1)}),(0,t.jsx)("aside",{className:`md:hidden fixed inset-y-0 left-0 w-72 bg-[#253341] z-50 transform transition-transform duration-300 ease-in-out border-r border-zinc-800 ${b?"translate-x-0":"-translate-x-full"}`,children:(0,t.jsx)("div",{className:"flex flex-col h-full border-r border-transparent",children:(0,t.jsx)(z,{})})}),(0,t.jsxs)("header",{className:"md:hidden fixed top-0 w-full bg-white border-b border-zinc-200 z-20 px-4 h-14 flex items-center justify-between dark:bg-zinc-950 dark:border-zinc-800",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("button",{onClick:()=>g(!0),className:"p-1 -ml-1 text-zinc-500 hover:text-zinc-900 dark:text-zinc-400 dark:hover:text-zinc-100",children:(0,t.jsx)(l,{size:20})}),(0,t.jsx)("span",{className:"font-bold text-zinc-900 dark:text-zinc-50 truncate max-w-[200px]",children:u.title})]}),(0,t.jsx)($.UserMenu,{})]}),(0,t.jsx)("main",{className:"flex-1 md:ml-64 p-4 md:p-8 pt-20 md:pt-8 animate-in fade-in duration-500",children:(0,t.jsx)("div",{className:"max-w-5xl mx-auto",children:(0,t.jsx)(j,{project:v,episode:u,onUpdate:e=>{let t=["title","concept","outline","structureBoard","structureBeats","linkedCharacterIds"],s={};Object.keys(e).forEach(r=>{t.includes(r)&&(s[r]=e[r])}),Object.keys(s).length>0&&m(s)}})})})]})}e.s(["EpisodePageClient",()=>q],37117)}]);