module.exports=[54826,(a,b,c)=>{},15299,(a,b,c)=>{a.r(54826);var d=a.r(72131),e=d&&"object"==typeof d&&"default"in d?d:{default:d},f="u">typeof process&&process.env&&!0,g=function(a){return"[object String]"===Object.prototype.toString.call(a)},h=function(){function a(a){var b=void 0===a?{}:a,c=b.name,d=void 0===c?"stylesheet":c,e=b.optimizeForSpeed,h=void 0===e?f:e;i(g(d),"`name` must be a string"),this._name=d,this._deletedRulePlaceholder="#"+d+"-deleted-rule____{}",i("boolean"==typeof h,"`optimizeForSpeed` must be a boolean"),this._optimizeForSpeed=h,this._serverSheet=void 0,this._tags=[],this._injected=!1,this._rulesCount=0,this._nonce=null}var b,c=a.prototype;return c.setOptimizeForSpeed=function(a){i("boolean"==typeof a,"`setOptimizeForSpeed` accepts a boolean"),i(0===this._rulesCount,"optimizeForSpeed cannot be when rules have already been inserted"),this.flush(),this._optimizeForSpeed=a,this.inject()},c.isOptimizeForSpeed=function(){return this._optimizeForSpeed},c.inject=function(){var a=this;i(!this._injected,"sheet already injected"),this._injected=!0,this._serverSheet={cssRules:[],insertRule:function(b,c){return"number"==typeof c?a._serverSheet.cssRules[c]={cssText:b}:a._serverSheet.cssRules.push({cssText:b}),c},deleteRule:function(b){a._serverSheet.cssRules[b]=null}}},c.getSheetForTag=function(a){if(a.sheet)return a.sheet;for(var b=0;b<document.styleSheets.length;b++)if(document.styleSheets[b].ownerNode===a)return document.styleSheets[b]},c.getSheet=function(){return this.getSheetForTag(this._tags[this._tags.length-1])},c.insertRule=function(a,b){return i(g(a),"`insertRule` accepts only strings"),"number"!=typeof b&&(b=this._serverSheet.cssRules.length),this._serverSheet.insertRule(a,b),this._rulesCount++},c.replaceRule=function(a,b){this._optimizeForSpeed;var c=this._serverSheet;if(b.trim()||(b=this._deletedRulePlaceholder),!c.cssRules[a])return a;c.deleteRule(a);try{c.insertRule(b,a)}catch(d){f||console.warn("StyleSheet: illegal rule: \n\n"+b+"\n\nSee https://stackoverflow.com/q/20007992 for more info"),c.insertRule(this._deletedRulePlaceholder,a)}return a},c.deleteRule=function(a){this._serverSheet.deleteRule(a)},c.flush=function(){this._injected=!1,this._rulesCount=0,this._serverSheet.cssRules=[]},c.cssRules=function(){return this._serverSheet.cssRules},c.makeStyleTag=function(a,b,c){b&&i(g(b),"makeStyleTag accepts only strings as second parameter");var d=document.createElement("style");this._nonce&&d.setAttribute("nonce",this._nonce),d.type="text/css",d.setAttribute("data-"+a,""),b&&d.appendChild(document.createTextNode(b));var e=document.head||document.getElementsByTagName("head")[0];return c?e.insertBefore(d,c):e.appendChild(d),d},b=[{key:"length",get:function(){return this._rulesCount}}],function(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}(a.prototype,b),a}();function i(a,b){if(!a)throw Error("StyleSheet: "+b+".")}var j=function(a){for(var b=5381,c=a.length;c;)b=33*b^a.charCodeAt(--c);return b>>>0},k={};function l(a,b){if(!b)return"jsx-"+a;var c=String(b),d=a+c;return k[d]||(k[d]="jsx-"+j(a+"-"+c)),k[d]}function m(a,b){var c=a+(b=b.replace(/\/style/gi,"\\/style"));return k[c]||(k[c]=b.replace(/__jsx-style-dynamic-selector/g,a)),k[c]}var n=function(){function a(a){var b=void 0===a?{}:a,c=b.styleSheet,d=void 0===c?null:c,e=b.optimizeForSpeed,f=void 0!==e&&e;this._sheet=d||new h({name:"styled-jsx",optimizeForSpeed:f}),this._sheet.inject(),d&&"boolean"==typeof f&&(this._sheet.setOptimizeForSpeed(f),this._optimizeForSpeed=this._sheet.isOptimizeForSpeed()),this._fromServer=void 0,this._indices={},this._instancesCounts={}}var b=a.prototype;return b.add=function(a){var b=this;void 0===this._optimizeForSpeed&&(this._optimizeForSpeed=Array.isArray(a.children),this._sheet.setOptimizeForSpeed(this._optimizeForSpeed),this._optimizeForSpeed=this._sheet.isOptimizeForSpeed());var c=this.getIdAndRules(a),d=c.styleId,e=c.rules;if(d in this._instancesCounts){this._instancesCounts[d]+=1;return}var f=e.map(function(a){return b._sheet.insertRule(a)}).filter(function(a){return -1!==a});this._indices[d]=f,this._instancesCounts[d]=1},b.remove=function(a){var b=this,c=this.getIdAndRules(a).styleId;if(function(a,b){if(!a)throw Error("StyleSheetRegistry: "+b+".")}(c in this._instancesCounts,"styleId: `"+c+"` not found"),this._instancesCounts[c]-=1,this._instancesCounts[c]<1){var d=this._fromServer&&this._fromServer[c];d?(d.parentNode.removeChild(d),delete this._fromServer[c]):(this._indices[c].forEach(function(a){return b._sheet.deleteRule(a)}),delete this._indices[c]),delete this._instancesCounts[c]}},b.update=function(a,b){this.add(b),this.remove(a)},b.flush=function(){this._sheet.flush(),this._sheet.inject(),this._fromServer=void 0,this._indices={},this._instancesCounts={}},b.cssRules=function(){var a=this,b=this._fromServer?Object.keys(this._fromServer).map(function(b){return[b,a._fromServer[b]]}):[],c=this._sheet.cssRules();return b.concat(Object.keys(this._indices).map(function(b){return[b,a._indices[b].map(function(a){return c[a].cssText}).join(a._optimizeForSpeed?"":"\n")]}).filter(function(a){return!!a[1]}))},b.styles=function(a){var b,c;return b=this.cssRules(),void 0===(c=a)&&(c={}),b.map(function(a){var b=a[0],d=a[1];return e.default.createElement("style",{id:"__"+b,key:"__"+b,nonce:c.nonce?c.nonce:void 0,dangerouslySetInnerHTML:{__html:d}})})},b.getIdAndRules=function(a){var b=a.children,c=a.dynamic,d=a.id;if(c){var e=l(d,c);return{styleId:e,rules:Array.isArray(b)?b.map(function(a){return m(e,a)}):[m(e,b)]}}return{styleId:l(d),rules:Array.isArray(b)?b:[b]}},b.selectFromServer=function(){return Array.prototype.slice.call(document.querySelectorAll('[id^="__jsx-"]')).reduce(function(a,b){return a[b.id.slice(2)]=b,a},{})},a}(),o=d.createContext(null);function p(){return new n}function q(){return d.useContext(o)}function r(a){var b=q();return b&&b.add(a),null}o.displayName="StyleSheetContext",e.default.useInsertionEffect||e.default.useLayoutEffect,r.dynamic=function(a){return a.map(function(a){return l(a[0],a[1])}).join(" ")},c.StyleRegistry=function(a){var b=a.registry,c=a.children,f=d.useContext(o),g=d.useState(function(){return f||b||p()})[0];return e.default.createElement(o.Provider,{value:g},c)},c.createStyleRegistry=p,c.style=r,c.useStyleRegistry=q},31626,(a,b,c)=>{b.exports=a.r(15299).style},96293,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(38246),e=a.i(70106);let f=(0,e.default)("chevron-right",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);var g=a.i(210);let h=(0,e.default)("menu",[["path",{d:"M4 5h16",key:"1tepv9"}],["path",{d:"M4 12h16",key:"1lakjw"}],["path",{d:"M4 19h16",key:"1djgab"}]]);var i=a.i(96438),j=a.i(21920);let k=({project:a,onUpdate:d})=>{let[e,f]=(0,c.useState)({theme:a.concept?.theme||"",title:a.title||"",emotions:a.concept?.emotions||"",keywords:a.concept?.keywords||"",note:a.concept?.note||""});(0,c.useEffect)(()=>{f({theme:a.concept?.theme||"",title:a.title||"",emotions:a.concept?.emotions||"",keywords:a.concept?.keywords||"",note:a.concept?.note||""})},[a.concept]);let g=(a,b)=>{f({...e,[a]:b})},h=()=>{d({title:e.title,concept:{theme:e.theme,emotions:e.emotions,keywords:e.keywords,note:e.note}})};return(0,b.jsx)("div",{className:"space-y-8 max-w-3xl animate-in fade-in slide-in-from-bottom-4 duration-500",children:(0,b.jsxs)("div",{className:"bg-white p-6 rounded-xl border border-zinc-200 shadow-sm dark:bg-zinc-950 dark:border-zinc-800",children:[(0,b.jsxs)("h2",{className:"text-xl font-bold mb-6 flex items-center gap-2 text-zinc-900 dark:text-zinc-50",children:[(0,b.jsx)("span",{className:"flex items-center justify-center w-8 h-8 rounded-full bg-zinc-900 text-zinc-50 text-sm dark:bg-zinc-100 dark:text-zinc-900",children:"1"}),"企画コンセプト"]}),(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("label",{className:"text-sm font-semibold text-zinc-700 dark:text-zinc-300",children:"エピソードタイトル"}),(0,b.jsx)("p",{className:"text-sm text-zinc-500",children:"エピソードの題名を入力してください。"}),(0,b.jsx)("input",{type:"text",value:e.title,onChange:a=>g("title",a.target.value),onBlur:h,placeholder:"エピソードタイトルを入力...",className:"w-full p-3 rounded-lg border border-zinc-200 bg-zinc-50 focus:bg-white focus:ring-2 focus:ring-zinc-900 focus:outline-none transition-all text-zinc-900 dark:bg-zinc-900 dark:border-zinc-800 dark:text-zinc-50 dark:focus:ring-zinc-100 dark:focus:bg-zinc-900 font-bold text-base"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("label",{className:"text-sm font-semibold text-zinc-700 dark:text-zinc-300",children:"テーマ（一言で言うと？）"}),(0,b.jsx)("p",{className:"text-sm text-zinc-500",children:"例：「友情と犠牲」「AIと人間の共存」など、作品の核となる概念。"}),(0,b.jsx)("input",{type:"text",value:e.theme,onChange:a=>g("theme",a.target.value),onBlur:h,placeholder:"テーマを入力...",className:"w-full p-3 rounded-lg border border-zinc-200 bg-zinc-50 focus:bg-white focus:ring-2 focus:ring-zinc-900 focus:outline-none transition-all text-zinc-900 dark:bg-zinc-900 dark:border-zinc-800 dark:text-zinc-50 dark:focus:ring-zinc-100 dark:focus:bg-zinc-900"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("label",{className:"text-sm font-semibold text-zinc-700 dark:text-zinc-300",children:"読後感（読者にどう感じてほしい？）"}),(0,b.jsx)("p",{className:"text-sm text-zinc-500",children:"例：「スカッとする」「ほっこりする」「考えさせられる」"}),(0,b.jsx)("input",{type:"text",value:e.emotions,onChange:a=>g("emotions",a.target.value),onBlur:h,placeholder:"読後感を入力...",className:"w-full p-3 rounded-lg border border-zinc-200 bg-zinc-50 focus:bg-white focus:ring-2 focus:ring-zinc-900 focus:outline-none transition-all text-zinc-900 dark:bg-zinc-900 dark:border-zinc-800 dark:text-zinc-50 dark:focus:ring-zinc-100 dark:focus:bg-zinc-900"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("label",{className:"text-sm font-semibold text-zinc-700 dark:text-zinc-300",children:"キーワード（要素・モチーフ）"}),(0,b.jsx)("p",{className:"text-sm text-zinc-500",children:"例：「魔法学園」「タイムリープ」「猫」「ピアノ」"}),(0,b.jsx)("textarea",{value:e.keywords,onChange:a=>g("keywords",a.target.value),onBlur:h,rows:2,placeholder:"キーワードを列挙...",className:"w-full p-3 rounded-lg border border-zinc-200 bg-zinc-50 focus:bg-white focus:ring-2 focus:ring-zinc-900 focus:outline-none transition-all text-zinc-900 dark:bg-zinc-900 dark:border-zinc-800 dark:text-zinc-50 dark:focus:ring-zinc-100 dark:focus:bg-zinc-900 resize-none text-base"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("label",{className:"text-sm font-semibold text-zinc-700 dark:text-zinc-300",children:"イメージメモ"}),(0,b.jsx)("p",{className:"text-sm text-zinc-500",children:"思いついたアイデアやシーン、セリフなどを自由に書き留めてください。"}),(0,b.jsx)("textarea",{value:e.note,onChange:a=>g("note",a.target.value),onBlur:h,rows:6,placeholder:"自由にメモ...",className:"w-full p-3 rounded-lg border border-zinc-200 bg-zinc-50 focus:bg-white focus:ring-2 focus:ring-zinc-900 focus:outline-none transition-all text-zinc-900 dark:bg-zinc-900 dark:border-zinc-800 dark:text-zinc-50 dark:focus:ring-zinc-100 dark:focus:bg-zinc-900 resize-none text-base"})]})]})]})})};var l=a.i(15618),m=a.i(33508),n=a.i(84581),o=a.i(49741),p=a.i(49140),q=a.i(14512);let r={vs:{label:"VS",color:"text-red-600",bg:"bg-red-100 dark:bg-red-900/30 dark:text-red-400"},wakuwaku:{label:"ワクワク",color:"text-orange-600",bg:"bg-orange-100 dark:bg-orange-900/30 dark:text-orange-400"},dokidoki:{label:"ドキドキ",color:"text-purple-600",bg:"bg-purple-100 dark:bg-purple-900/30 dark:text-purple-400"},bikkuri:{label:"ビックリ",color:"text-blue-600",bg:"bg-blue-100 dark:bg-blue-900/30 dark:text-blue-400"}},s=({card:a,onDelete:c,onUpdate:d,isOverlay:e=!1})=>{let{attributes:f,listeners:g,setNodeRef:h,transform:i,transition:j,isDragging:k}=(0,p.useSortable)({id:a.id,data:{act:a.act}}),l={transform:q.CSS.Transform.toString(i),transition:j,opacity:k?.4:1};return(0,b.jsx)("div",{ref:h,style:l,className:`bg-white rounded-lg border border-zinc-200 p-3 shadow-sm group hover:border-zinc-300 dark:bg-zinc-900 dark:border-zinc-800 dark:hover:border-zinc-700 ${e?"shadow-xl cursor-grabbing":""}`,children:(0,b.jsxs)("div",{className:"flex items-start gap-2",children:[(0,b.jsx)("div",{...f,...g,className:"mt-1 text-zinc-300 hover:text-zinc-600 cursor-grab active:cursor-grabbing dark:text-zinc-700 dark:hover:text-zinc-400",children:(0,b.jsx)(n.GripVertical,{size:16})}),(0,b.jsxs)("div",{className:"flex-1 space-y-2",children:[(0,b.jsx)("textarea",{value:a.content,onChange:b=>d&&d(a.id,{content:b.target.value}),placeholder:"イベント等の内容",rows:2,className:"w-full bg-transparent text-sm resize-none focus:outline-none placeholder:text-zinc-400 text-zinc-900 dark:text-zinc-50",onMouseDown:a=>a.stopPropagation()}),(0,b.jsx)("div",{className:"flex flex-wrap gap-1",children:Object.keys(r).map(c=>(0,b.jsx)("button",{onClick:()=>(b=>{if(!d)return;let c=a.tags||[],e=c.includes(b)?c.filter(a=>a!==b):[...c,b];d(a.id,{tags:e})})(c),onMouseDown:a=>a.stopPropagation(),className:`px-1.5 py-0.5 text-[11px] rounded border transition-colors ${a.tags?.includes(c)?`${r[c].bg} ${r[c].color} border-transparent font-bold`:"bg-transparent text-zinc-400 border-zinc-200 dark:border-zinc-800 dark:text-zinc-600 hover:bg-zinc-50 dark:hover:bg-zinc-800"}`,children:r[c].label},c))})]}),c&&(0,b.jsx)("button",{onClick:()=>c(a.id),className:"text-zinc-300 hover:text-red-500 opacity-0 group-hover:opacity-100 transition-opacity",onMouseDown:a=>a.stopPropagation(),children:(0,b.jsx)(m.X,{size:14})})]})})};var t=a.i(91011),u=a.i(46842),v=a.i(81560),w=a.i(87532),x=a.i(33441);let y=(0,e.default)("link",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]]),z=(0,e.default)("external-link",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]),A=(0,e.default)("message-square",[["path",{d:"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z",key:"18887p"}]]),B=(0,e.default)("sticky-note",[["path",{d:"M21 9a2.4 2.4 0 0 0-.706-1.706l-3.588-3.588A2.4 2.4 0 0 0 15 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2z",key:"1dfntj"}],["path",{d:"M15 3v5a1 1 0 0 0 1 1h5",key:"6s6qgf"}]]),C=(0,e.default)("eraser",[["path",{d:"M21 21H8a2 2 0 0 1-1.42-.587l-3.994-3.999a2 2 0 0 1 0-2.828l10-10a2 2 0 0 1 2.829 0l5.999 6a2 2 0 0 1 0 2.828L12.834 21",key:"g5wo59"}],["path",{d:"m5.082 11.09 8.828 8.828",key:"1wx5vj"}]]),D=(0,e.default)("undo-2",[["path",{d:"M9 14 4 9l5-5",key:"102s5s"}],["path",{d:"M4 9h10.5a5.5 5.5 0 0 1 5.5 5.5a5.5 5.5 0 0 1-5.5 5.5H11",key:"f3b9sd"}]]),E=(0,e.default)("redo-2",[["path",{d:"m15 14 5-5-5-5",key:"12vg1m"}],["path",{d:"M20 9H9.5A5.5 5.5 0 0 0 4 14.5A5.5 5.5 0 0 0 9.5 20H13",key:"6uklza"}]]),F=({initialData:a,onChange:d,className:e="",showTools:f=!0})=>{let g=(0,c.useRef)(null),[h,i]=(0,c.useState)(!1),[j,k]=(0,c.useState)(null),[l,m]=(0,c.useState)(1),[n,o]=(0,c.useState)("pen"),[p,q]=(0,c.useState)([]),[r,s]=(0,c.useState)([]),t=(0,c.useRef)([]),u=(0,c.useRef)(void 0);(0,c.useEffect)(()=>{let b=g.current;if(!b)return;let c=b.getContext("2d",{alpha:!0});if(c)if(c.lineJoin="round",c.lineCap="round",c.lineWidth=l,c.strokeStyle="#000000",k(c),a){let d=new Image;d.onload=()=>{c.clearRect(0,0,b.width,b.height),c.drawImage(d,0,0),q([a])},d.src=a}else c.clearRect(0,0,b.width,b.height),q([""])},[a]),(0,c.useEffect)(()=>{if(a&&!p.includes(a)){let b=new Image;b.onload=()=>{j?.clearRect(0,0,g.current.width,g.current.height),j?.drawImage(b,0,0),q(b=>[...b,a]),s([])},b.src=a}},[a,p,j]),(0,c.useEffect)(()=>{j&&(j.lineWidth=l,j.globalCompositeOperation="eraser"===n?"destination-out":"source-over","pen"===n&&(j.strokeStyle="#000000"))},[l,n,j]);let v=(0,c.useCallback)(()=>{if(g.current){let a=g.current.toDataURL();q(b=>[...b,a]),s([]),d(a)}},[d]),w=(0,c.useCallback)(()=>{if(p.length<=1)return;let a=[...p],b=a.pop();s(a=>[...a,b]),q(a);let c=a[a.length-1],e=g.current;if(e&&j){if(j.clearRect(0,0,e.width,e.height),c){let a=new Image;a.onload=()=>j.drawImage(a,0,0),a.src=c}d(c)}},[p,j,d]),x=(0,c.useCallback)(()=>{if(0===r.length)return;let a=[...r],b=a.pop();q(a=>[...a,b]),s(a);let c=g.current;if(c&&j){j.clearRect(0,0,c.width,c.height);let a=new Image;a.onload=()=>j.drawImage(a,0,0),a.src=b,d(b)}},[r,j,d]);(0,c.useEffect)(()=>{if(!f)return;let a=a=>{let b=a.ctrlKey||a.metaKey,c=a.shiftKey;b&&!c&&"z"===a.key?(a.preventDefault(),w()):(b&&c&&"z"===a.key||b&&"y"===a.key)&&(a.preventDefault(),x())};return window.addEventListener("keydown",a),()=>window.removeEventListener("keydown",a)},[w,x,f]);let y=a=>{let b=g.current;if(!b)return{x:0,y:0};let c=b.getBoundingClientRect();return{x:(a.clientX-c.left)*(b.width/c.width),y:(a.clientY-c.top)*(b.height/c.height)}},z=(0,c.useCallback)(()=>{if(!j||t.current.length<2)return;let a=t.current;j.beginPath(),j.moveTo(a[0].x,a[0].y);for(let b=1;b<a.length-2;b++){let c=(a[b].x+a[b+1].x)/2,d=(a[b].y+a[b+1].y)/2;j.quadraticCurveTo(a[b].x,a[b].y,c,d)}if(a.length>2){let b=a.length-2;j.quadraticCurveTo(a[b].x,a[b].y,a[b+1].x,a[b+1].y)}else 2===a.length&&j.lineTo(a[1].x,a[1].y);j.stroke()},[j]),A=()=>{h&&(i(!1),u.current&&cancelAnimationFrame(u.current),t.current=[],v())};return(0,b.jsxs)("div",{className:`flex flex-col bg-[#0a0a0a] border border-zinc-800 rounded-lg overflow-hidden w-full ${e}`,children:[(0,b.jsx)("div",{className:"relative w-full aspect-video bg-white overflow-hidden touch-none",children:(0,b.jsx)("canvas",{ref:g,width:320,height:180,onPointerDown:a=>{if(!j)return;i(!0);let b=y(a);t.current=[b],j.beginPath(),j.moveTo(b.x,b.y)},onPointerMove:a=>{if(h&&j){for(let b of a.nativeEvent.getCoalescedEvents?.()||[a.nativeEvent]){let a=y(b);t.current.push(a)}u.current&&cancelAnimationFrame(u.current),u.current=requestAnimationFrame(()=>{z()})}},onPointerUp:A,onPointerLeave:A,onPointerCancel:A,className:"w-full h-full block cursor-crosshair touch-none relative z-10"})}),f&&(0,b.jsxs)("div",{className:"bg-zinc-950 border-t border-zinc-800 p-3 md:p-4 flex flex-wrap items-center justify-between gap-4",children:[(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[(0,b.jsxs)("div",{className:"flex gap-1 bg-zinc-900 p-1 rounded-xl border border-white/5",children:[(0,b.jsxs)("button",{onClick:()=>o("pen"),className:`w-12 h-10 flex flex-col items-center justify-center rounded-lg transition-all ${"pen"===n?"bg-primary text-white font-bold":"text-zinc-500 hover:text-white"}`,title:"ペン",children:[(0,b.jsx)("span",{className:"text-[14px]",children:"✎"}),(0,b.jsx)("span",{className:"text-[8px] font-black leading-tight",children:"ペン"})]}),(0,b.jsxs)("button",{onClick:()=>o("eraser"),className:`w-12 h-10 flex flex-col items-center justify-center rounded-lg transition-all ${"eraser"===n?"bg-primary text-white font-bold":"text-zinc-500 hover:text-white"}`,title:"消しゴム",children:[(0,b.jsx)(C,{size:14}),(0,b.jsx)("span",{className:"text-[8px] font-black leading-tight",children:"消しゴム"})]})]}),(0,b.jsxs)("div",{className:"flex gap-1 bg-zinc-900 p-1 rounded-xl border border-white/5",children:[(0,b.jsx)("button",{onClick:w,disabled:p.length<=1,className:"w-10 h-10 flex items-center justify-center rounded-lg text-zinc-400 hover:bg-zinc-800 hover:text-white disabled:opacity-20 transition-all",title:"元に戻す (Ctrl+Z)",children:(0,b.jsx)(D,{size:18})}),(0,b.jsx)("button",{onClick:x,disabled:0===r.length,className:"w-10 h-10 flex items-center justify-center rounded-lg text-zinc-400 hover:bg-zinc-800 hover:text-white disabled:opacity-20 transition-all",title:"やり直し (Ctrl+Y / Ctrl+Shift+Z)",children:(0,b.jsx)(E,{size:18})})]}),(0,b.jsx)("div",{className:"flex gap-1 bg-zinc-900 p-1 rounded-xl border border-white/5",children:[{id:"extra-fine",label:"極細",value:1,dotSize:"w-0.5 h-0.5"},{id:"fine",label:"細",value:3,dotSize:"w-1.5 h-1.5"},{id:"medium",label:"中",value:6,dotSize:"w-2.5 h-2.5"}].map(a=>(0,b.jsxs)("button",{onClick:()=>m(a.value),className:`flex flex-col items-center justify-center min-w-[48px] h-10 rounded-lg transition-all ${l===a.value?"bg-primary text-white font-bold shadow-lg":"text-zinc-500 hover:bg-zinc-800 hover:text-white"}`,children:[(0,b.jsx)("div",{className:`rounded-full mb-0.5 ${a.dotSize} ${l===a.value?"bg-white":"bg-current"}`}),(0,b.jsx)("span",{className:"text-[9px] font-black",children:a.label})]},a.id))})]}),(0,b.jsxs)("button",{onClick:()=>{j&&g.current&&(j.clearRect(0,0,g.current.width,g.current.height),v())},className:"flex items-center gap-2 px-4 h-10 bg-zinc-900 border border-white/5 rounded-xl text-zinc-400 hover:bg-red-500 hover:text-white hover:border-red-600 transition-all font-bold",children:[(0,b.jsx)(C,{size:14}),(0,b.jsx)("span",{className:"text-sm",children:"クリア"})]})]})]})},G=(0,e.default)("save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]),H=({isOpen:a,onClose:d,initialData:e,onSave:f,title:g="ネームの下書き"})=>{let[h,j]=(0,c.useState)(e),[k,l]=(0,c.useState)(!1),[n,o]=(0,c.useState)(!1);if((0,c.useEffect)(()=>{a&&(j(e),l(!1),o(!1))},[a,e]),!a)return null;let p=async()=>{if(!k){l(!0);try{await f(h),o(!0),setTimeout(()=>{o(!1),d()},800)}catch(a){console.error("Save failed:",a),l(!1)}}};return(0,b.jsxs)("div",{id:"modal-overlay",className:"fixed inset-0 z-[100] bg-black/95 flex flex-col p-0 m-0 animate-in fade-in duration-300",onClick:a=>{"modal-overlay"===a.target.id&&p()},children:[n&&(0,b.jsxs)("div",{className:"fixed top-12 left-1/2 -translate-x-1/2 z-[150] bg-white text-black px-8 py-3 rounded-full font-black shadow-[0_10px_40px_rgba(255,255,255,0.2)] flex items-center gap-3 animate-in slide-in-from-top-8",children:[(0,b.jsx)("div",{className:"w-2.5 h-2.5 bg-green-500 rounded-full animate-pulse"}),"保存しました"]}),(0,b.jsxs)("div",{className:"h-20 flex items-center justify-between px-8 bg-zinc-950 border-b border-white/5",onClick:a=>a.stopPropagation(),children:[(0,b.jsxs)("div",{className:"flex items-center gap-6",children:[(0,b.jsx)("button",{onClick:d,disabled:k,className:"p-3 text-zinc-500 hover:text-white hover:bg-zinc-900 rounded-xl transition-all disabled:opacity-30",title:"変更を破棄して閉じる",children:(0,b.jsx)(m.X,{size:28})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h2",{className:"text-white font-black text-xl tracking-tight",children:g}),(0,b.jsx)("p",{className:"text-sm text-zinc-600 font-bold uppercase tracking-widest mt-0.5",children:"Focus Mode / Full Screen"})]})]}),(0,b.jsxs)(i.Button,{onClick:p,disabled:k,size:"lg",className:"bg-white text-black hover:bg-zinc-200 font-black px-8 h-12 rounded-xl disabled:bg-zinc-700",children:[(0,b.jsx)(G,{size:20,className:"mr-2"}),k?"保存中...":"保存して閉じる"]})]}),(0,b.jsxs)("div",{className:"flex-1 overflow-hidden flex flex-col items-center justify-center p-6 md:p-12",onClick:a=>{"editor-container"===a.target.id&&p()},id:"editor-container",children:[(0,b.jsx)("div",{className:"w-full max-w-5xl bg-zinc-950 rounded-2xl shadow-[0_0_100px_rgba(255,255,255,0.03)] border border-white/10 overflow-hidden",onClick:a=>a.stopPropagation(),children:(0,b.jsx)(F,{initialData:e,onChange:j,className:"w-full border-0",showTools:!0})}),(0,b.jsx)("div",{className:"mt-8 text-zinc-600 text-xs font-bold tracking-widest uppercase opacity-40",children:"画面の外側をタップしてクイック保存"})]})]})},I=a=>{let{dialogue:d,panelId:e,groupId:f,characters:g,groups:h,onUpdate:i,onDelete:j}=a,k=g?.find(a=>a.id===d.characterId),{attributes:l,listeners:m,setNodeRef:o,transform:r,transition:s,isDragging:t}=(0,p.useSortable)({id:d.id,data:{type:"dialogue",panelId:e,groupId:f}}),w={transform:q.CSS.Transform.toString(r),transition:s,opacity:t?.3:1,zIndex:50*!!t},[x,y]=(0,c.useState)(!!d.memo);return(0,b.jsx)("div",{ref:o,style:w,className:`bg-[#0a0a0a]/50 backdrop-blur-sm border ${t?"border-zinc-400":"border-zinc-700"} rounded-lg p-3 group/dialogue transition-all hover:bg-zinc-800 hover:border-zinc-600`,children:(0,b.jsxs)("div",{className:"flex items-start gap-3",children:[(0,b.jsx)("div",{...l,...m,className:"text-zinc-400 hover:text-white cursor-grab active:cursor-grabbing mt-2 shrink-0",children:(0,b.jsx)(n.GripVertical,{size:16})}),(0,b.jsxs)("div",{className:"relative w-8 h-8 rounded-full bg-zinc-700 border border-zinc-600 overflow-hidden flex items-center justify-center shrink-0 mt-0.5 group/icon cursor-pointer",children:[k?.icon?(0,b.jsx)("img",{src:k.icon,alt:k.name,className:"w-full h-full object-cover"}):(0,b.jsx)(u.User,{size:16,className:"text-zinc-400"}),g&&g.length>0&&(0,b.jsxs)("select",{value:d.characterId||"",onChange:a=>{let b=a.target.value,c=g.find(a=>a.id===b)?.name||"";i(f,e,d.id,{characterId:b,character:c})},className:"absolute inset-0 opacity-0 cursor-pointer text-[16px] w-full h-full",title:"キャラクターを選択",children:[(0,b.jsx)("option",{value:"",children:"キャラクター選択解除"}),h&&h.length>0?h.map(a=>{let c=g.filter(b=>b.groupIds?.includes(a.id));return 0===c.length?null:(0,b.jsx)("optgroup",{label:a.name,children:c.map(a=>(0,b.jsx)("option",{value:a.id,children:a.name},a.id))},a.id)}):g.map(a=>(0,b.jsx)("option",{value:a.id,children:a.name},a.id)),h&&h.length>0&&g.filter(a=>!a.groupIds||0===a.groupIds.length).length>0&&(0,b.jsx)("optgroup",{label:"その他",children:g.filter(a=>!a.groupIds||0===a.groupIds.length).map(a=>(0,b.jsx)("option",{value:a.id,children:a.name},a.id))})]})]}),(0,b.jsx)("div",{className:"w-28 shrink-0 mt-1",children:(0,b.jsx)("input",{value:d.character,onChange:a=>i(f,e,d.id,{character:a.target.value}),placeholder:"名前",className:"bg-transparent text-base font-bold text-zinc-300 placeholder:text-zinc-500 focus:outline-none w-full border-b border-transparent focus:border-zinc-600 pb-0.5"})}),(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsx)("textarea",{value:d.text,onChange:a=>i(f,e,d.id,{text:a.target.value}),placeholder:"セリフを入力...",rows:1,className:"w-full bg-transparent text-base text-zinc-100 placeholder:text-zinc-500 focus:outline-none resize-none leading-relaxed py-1.5 min-h-[32px]"}),x&&(0,b.jsxs)("div",{className:"relative mt-1",children:[(0,b.jsx)("input",{value:d.memo,onChange:a=>i(f,e,d.id,{memo:a.target.value}),placeholder:"演出メモを入力...",className:"w-full bg-zinc-900/50 border border-zinc-700/50 rounded px-2 py-1 text-base text-zinc-300 placeholder:text-zinc-500 focus:outline-none focus:border-zinc-600 focus:bg-zinc-900 transition-colors"}),(0,b.jsx)("button",{onClick:()=>{i(f,e,d.id,{memo:""}),y(!1)},className:"absolute right-1 top-1/2 -translate-y-1/2 text-zinc-600 hover:text-zinc-400 p-1",title:"メモを削除して閉じる",children:(0,b.jsx)(v.Trash2,{size:12})})]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-1 mt-0.5 shrink-0 opacity-0 group-hover/dialogue:opacity-100 transition-opacity",children:[!x&&(0,b.jsx)("button",{onClick:()=>y(!0),className:"p-2 text-zinc-500 hover:text-zinc-300 transition-colors",title:"演出メモを追加",children:(0,b.jsx)(B,{size:16})}),(0,b.jsx)("button",{onClick:()=>j(f,e,d.id),className:"p-2 text-zinc-500 hover:text-red-400 transition-colors",title:"削除",children:(0,b.jsx)(v.Trash2,{size:16})})]})]})})},J=({item:a,parentId:c,activeId:d,activeType:e,characters:f,groups:g,onUpdateItem:h,onDeleteItem:j,onAddDialogue:k,onUpdateDialogue:m,onDeleteDialogue:r,onOpenModal:s})=>{let{attributes:t,listeners:u,setNodeRef:w,transform:x,transition:y,isDragging:z}=(0,p.useSortable)({id:a.id,data:{type:"panel",parentId:c}}),{setNodeRef:B,isOver:C}=(0,o.useDroppable)({id:`droppable-dialogue-${a.id}`,data:{type:"dialogue-container",panelId:a.id,parentId:c}}),D={transform:q.CSS.Transform.toString(x),transition:y,opacity:z?.3:1},E=C&&"dialogue"===e;return(0,b.jsxs)("div",{ref:w,style:D,className:`bg-zinc-900 rounded-xl border transition-all duration-200 overflow-hidden flex flex-col md:flex-row items-stretch md:items-start w-full relative min-h-[220px] 
                ${z?"border-zinc-400 shadow-xl":"border-zinc-800"}
                ${E?"ring-2 ring-zinc-400 ring-inset bg-zinc-800":""}
                group`,children:[(0,b.jsx)("button",{onClick:()=>j(c,a.id),className:"absolute top-4 right-4 p-2 bg-[#0a0a0a]/80 border border-zinc-700 rounded-lg text-zinc-400 hover:text-red-400 hover:border-red-400 transition-all z-40 opacity-0 group-hover:opacity-100",title:"パネルを削除",children:(0,b.jsx)(v.Trash2,{size:18})}),(0,b.jsxs)("div",{className:"relative w-full md:w-[320px] flex-shrink-0 flex flex-col items-stretch max-h-fit overflow-hidden cursor-pointer group/canvas bg-[#0a0a0a] rounded-t-lg md:rounded-l-lg md:rounded-tr-none",onClick:()=>s(a,c),children:[(0,b.jsx)("div",{className:"absolute inset-0 bg-[#0a0a0a]/60 opacity-0 group-hover/canvas:opacity-100 transition-opacity z-10 flex items-center justify-center",children:(0,b.jsx)("span",{className:"bg-zinc-900 text-white text-sm font-bold px-4 py-2 rounded-full border border-zinc-600 shadow-lg",children:"タップして全画面で描画"})}),(0,b.jsx)(F,{initialData:a.drawing,onChange:b=>h(c,a.id,{drawing:b}),className:"w-full h-full pointer-events-none",showTools:!1}),(0,b.jsx)("div",{...t,...u,className:"absolute top-3 left-3 p-2 bg-zinc-900/80 border border-zinc-600 rounded shadow-md opacity-0 group-hover:opacity-100 transition-opacity cursor-grab active:cursor-grabbing text-white z-20",onClick:a=>a.stopPropagation(),children:(0,b.jsx)(n.GripVertical,{size:18})})]}),(0,b.jsxs)("div",{ref:B,className:`flex-1 p-6 flex flex-col min-w-0 self-stretch transition-colors ${E?"bg-zinc-800":"bg-zinc-900/40"}`,children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-4 pr-12",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 text-zinc-400",children:[(0,b.jsx)(A,{size:16}),(0,b.jsx)("span",{className:"text-sm font-bold",children:"セリフ・演出"})]}),(0,b.jsxs)(i.Button,{variant:"ghost",size:"sm",onClick:()=>k(c,a.id),className:"text-sm font-bold text-zinc-400 hover:text-white hover:bg-zinc-800 border border-zinc-800 hover:border-zinc-600 px-3",children:[(0,b.jsx)(l.Plus,{size:14,className:"mr-1.5"})," 追加"]})]}),(0,b.jsxs)("div",{className:"space-y-3 flex-1 overflow-y-auto pr-2",children:[(0,b.jsx)(p.SortableContext,{items:a.dialogues?.map(a=>a.id)||[],strategy:p.verticalListSortingStrategy,children:a.dialogues?.map(d=>(0,b.jsx)(I,{dialogue:d,panelId:a.id,groupId:c,characters:f,groups:g,onUpdate:m,onDelete:r},d.id))}),(!a.dialogues||0===a.dialogues.length)&&(0,b.jsx)("div",{className:`h-full min-h-[100px] flex items-center justify-center border border-dashed rounded-lg transition-colors ${E?"border-zinc-500 bg-zinc-800":"border-zinc-800"}`,children:(0,b.jsx)("span",{className:"text-sm text-zinc-500 font-bold",children:E?"ここにドロップ":"セリフがありません"})})]})]})]})},K=({group:a,activeId:c,activeType:d,characters:e,groups:g,onAddItem:h,onUpdateItem:j,onDeleteItem:k,onAddDialogue:m,onUpdateDialogue:n,onDeleteDialogue:q,onOpenModal:s})=>{let{setNodeRef:t}=(0,o.useDroppable)({id:a.id,data:{type:"group"}});return(0,b.jsxs)("div",{ref:t,className:"space-y-8",children:[(0,b.jsxs)("div",{className:"flex items-center gap-4 border-b border-zinc-800 pb-2",children:[(0,b.jsxs)("h3",{className:"text-lg font-bold text-white flex items-center gap-2",children:[(0,b.jsx)(f,{size:20,className:"text-zinc-500"}),(0,b.jsx)("span",{children:a.content||"名称未定のエピソード"}),a.tags&&a.tags.length>0&&(0,b.jsx)("div",{className:"flex gap-1 ml-2",children:a.tags.map(a=>(0,b.jsx)("span",{className:`px-1.5 py-0.5 text-sm rounded border font-bold ${r[a]?.bg} ${r[a]?.color} border-transparent`,children:r[a]?.label},a))})]}),(0,b.jsx)("div",{className:"flex-1"}),(0,b.jsxs)(i.Button,{variant:"ghost",size:"sm",onClick:()=>h(a.id),className:"text-sm font-bold text-zinc-400 hover:text-white hover:bg-zinc-800 px-4",children:[(0,b.jsx)(l.Plus,{size:16,className:"mr-1.5"})," パネル追加"]})]}),(0,b.jsxs)("div",{className:"flex flex-col gap-10 p-4 max-w-5xl mx-auto",children:[(0,b.jsx)(p.SortableContext,{items:a.scenes?.map(a=>a.id)||[],strategy:p.verticalListSortingStrategy,children:a.scenes?.map(f=>(0,b.jsx)(J,{item:f,activeId:c,activeType:d,parentId:a.id,characters:e,groups:g,onUpdateItem:j,onDeleteItem:k,onAddDialogue:m,onUpdateDialogue:n,onDeleteDialogue:q,onOpenModal:s},f.id))}),a.scenes?.length===0?(0,b.jsxs)("div",{className:"py-20 flex flex-col items-center justify-center border-2 border-dashed border-zinc-800 rounded-3xl opacity-50 hover:opacity-100 transition-opacity",children:[(0,b.jsx)("p",{className:"text-zinc-500 text-sm font-bold mb-4",children:"パネルがありません"}),(0,b.jsxs)(i.Button,{onClick:()=>h(a.id),className:"bg-zinc-800 hover:bg-zinc-700 text-white font-bold px-6 py-2 rounded-full",children:[(0,b.jsx)(l.Plus,{size:16,className:"mr-2"})," 最初の一枚を追加"]})]}):(0,b.jsx)("div",{className:"flex justify-center pt-4",children:(0,b.jsxs)(i.Button,{variant:"ghost",onClick:()=>h(a.id),className:"text-sm font-bold text-zinc-500 hover:text-white border border-dashed border-zinc-700 hover:border-zinc-500 px-8 py-6 rounded-xl w-full",children:[(0,b.jsx)(l.Plus,{size:16,className:"mr-2"})," ここにパネルを追加"]})})]})]})};var L=a.i(31626);let M=(0,e.default)("printer",[["path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2",key:"143wyd"}],["path",{d:"M6 9V3a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v6",key:"1itne7"}],["rect",{x:"6",y:"14",width:"12",height:"8",rx:"1",key:"1ue0tg"}]]);var N=a.i(53722);let O=(0,e.default)("film",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M7 3v18",key:"bbkbws"}],["path",{d:"M3 7.5h4",key:"zfgn84"}],["path",{d:"M3 12h18",key:"1i2n21"}],["path",{d:"M3 16.5h4",key:"1230mu"}],["path",{d:"M17 3v18",key:"in4fa5"}],["path",{d:"M17 7.5h4",key:"myr1c1"}],["path",{d:"M17 16.5h4",key:"go4c1d"}]]);var P=a.i(84668);let Q=[{id:"1",label:"1. 企画コンセプト",component:k},{id:"2",label:"2. あらすじ作成",component:({project:a,onUpdate:d})=>{let[e,f]=(0,c.useState)({start:"",midpoint:"",decision:"",end:""});(0,c.useEffect)(()=>{a.outline&&f(a.outline)},[a.outline]);let g=()=>{d({outline:e})};return(0,b.jsx)("div",{className:"space-y-8 max-w-3xl animate-in fade-in slide-in-from-bottom-4 duration-500",children:(0,b.jsxs)("div",{className:"bg-white p-6 rounded-xl border border-zinc-200 shadow-sm dark:bg-zinc-950 dark:border-zinc-800",children:[(0,b.jsxs)("h2",{className:"text-xl font-bold mb-6 flex items-center gap-2 text-zinc-900 dark:text-zinc-50",children:[(0,b.jsx)("span",{className:"flex items-center justify-center w-8 h-8 rounded-full bg-zinc-900 text-zinc-50 text-sm dark:bg-zinc-100 dark:text-zinc-900",children:"2"}),"あらすじ作成"]}),(0,b.jsx)("p",{className:"text-sm text-zinc-500 mb-8 dark:text-zinc-400",children:"物語の骨組みとなる4つのポイントを決めましょう。「開始」と「終了」が変化していることが重要です。"}),(0,b.jsxs)("div",{className:"grid grid-cols-1 gap-8 relative",children:[(0,b.jsx)("div",{className:"hidden md:block absolute left-[19px] top-6 bottom-6 w-0.5 bg-zinc-100 dark:bg-zinc-800 -z-10"}),[{key:"start",label:"1. 開始（Start）",desc:"主人公の初期状態。ゴールの正反対の状態を描く。",placeholder:"例：魔法が使えず、誰からも期待されていない落ちこぼれ。"},{key:"midpoint",label:"2. 中間点（Midpoint）",desc:"物語の転換点。主人公が変化せざるを得ない出来事。",placeholder:"例：師匠が敵に捕まり、自分一人で戦うしかない状況になる。"},{key:"decision",label:"3. 決断（Decision）",desc:"変化の証明。過去の自分と決別し、リスクを取る決断。",placeholder:"例：逃げることをやめ、禁忌とされていた機械技術を使うことを決意する。"},{key:"end",label:"4. 終了（End）",desc:"ゴール。主人公が得た新しい日常や成長の結果。",placeholder:"例：魔法と科学を融合させた英雄として認められ、新しい時代を作る。"}].map(a=>(0,b.jsxs)("div",{className:"relative pl-0 md:pl-12",children:[(0,b.jsx)("div",{className:"hidden md:flex absolute left-0 top-0 w-10 h-10 rounded-full bg-zinc-100 border-4 border-white items-center justify-center text-zinc-500 font-bold dark:bg-zinc-800 dark:border-zinc-950 dark:text-zinc-400",children:a.label.split(".")[0]}),(0,b.jsxs)("div",{className:"space-y-2 group",children:[(0,b.jsxs)("label",{className:"text-base font-bold text-zinc-900 dark:text-zinc-50 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-1",children:[a.label,(0,b.jsx)("span",{className:"text-sm font-normal text-zinc-500 bg-zinc-50 px-2 py-1 rounded dark:bg-zinc-900",children:a.desc})]}),(0,b.jsx)("textarea",{value:e[a.key],onChange:b=>{var c,d;return c=a.key,d=b.target.value,void f(a=>({...a,[c]:d}))},onBlur:g,rows:4,placeholder:a.placeholder,className:"w-full p-4 rounded-xl border border-zinc-200 bg-zinc-50 focus:bg-white focus:ring-2 focus:ring-zinc-900 focus:outline-none transition-all text-zinc-900 shadow-sm dark:bg-zinc-900 dark:border-zinc-800 dark:text-zinc-50 dark:focus:ring-zinc-100 dark:focus:bg-zinc-900 resize-none hover:border-zinc-300 dark:hover:border-zinc-700 text-base"})]})]},a.key))]})]})})}},{id:"3",label:"3. 構造設計",component:({project:a,onUpdate:d})=>{let[e,f]=(0,c.useState)(a.structureBoard||[]),[g,h]=(0,c.useState)(a.structureBeats||{tp1:"",midpoint:"",tp2:""}),[j,k]=(0,c.useState)(null);(0,c.useEffect)(()=>{f(a.structureBoard||[]),a.structureBeats&&h(a.structureBeats)},[a.structureBoard,a.structureBeats]);let m=(a,b)=>{let c={...g,[a]:b};h(c),d({structureBeats:c})},n=(0,o.useSensors)((0,o.useSensor)(o.PointerSensor,{activationConstraint:{distance:8,delay:100}}),(0,o.useSensor)(o.KeyboardSensor,{coordinateGetter:p.sortableKeyboardCoordinates})),q=(a,b)=>{let c=e.map(c=>c.id===a?{...c,...b}:c);f(c),d({structureBoard:c})},r=a=>{let b=e.filter(b=>b.id!==a);f(b),d({structureBoard:b})};return(0,b.jsx)(o.DndContext,{sensors:n,collisionDetection:o.closestCenter,onDragStart:a=>{k(a.active.id)},onDragOver:a=>{let{active:b,over:c}=a;if(!c)return;let d=b.id,g=c.id,h=e.find(a=>a.id===d),i=e.find(a=>a.id===g);if(h){if(["1","2","3"].includes(g)){h.act!==g&&f(a=>{let b=[...a],c=b.findIndex(a=>a.id===d);return b[c].act=g,b});return}i&&h.act!==i.act&&f(a=>{let b=[...a],c=b.findIndex(a=>a.id===d);return b[c].act=i.act,(0,p.arrayMove)(b,c,b.indexOf(i))})}},onDragEnd:a=>{let{active:b,over:c}=a;if(k(null),!c)return;let g=b.id,h=c.id;c.data.current?.sortable?.containerId||c.id;let i=[...e],j=i.findIndex(a=>a.id===g);if(g!==h){let a=i.findIndex(a=>a.id===h);-1!==a&&((i=(0,p.arrayMove)(i,j,a))[j].act=i[a].act)}d({structureBoard:i}),f(i)},children:(0,b.jsxs)("div",{className:"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500",children:[(0,b.jsx)("div",{className:"flex items-center justify-between",children:(0,b.jsxs)("h2",{className:"text-xl font-bold flex items-center gap-2 text-zinc-900 dark:text-zinc-50",children:[(0,b.jsx)("span",{className:"flex items-center justify-center w-8 h-8 rounded-full bg-zinc-900 text-zinc-50 text-sm dark:bg-zinc-100 dark:text-zinc-900",children:"3"}),"構造設計 (三幕構成)"]})}),(0,b.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 md:h-[calc(100vh-200px)] min-h-[500px]",children:["1","2","3"].map(a=>(0,b.jsxs)("div",{className:"flex flex-col h-full bg-zinc-50 rounded-xl border border-zinc-200 dark:bg-zinc-900/50 dark:border-zinc-800",children:[(0,b.jsxs)("div",{className:"p-4 border-b border-zinc-200 dark:border-zinc-800 bg-zinc-100/50 dark:bg-zinc-900 rounded-t-xl",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,b.jsx)("h3",{className:"font-bold text-zinc-900 dark:text-zinc-50",children:"1"===a?"第一幕: 状況設定・問題提起":"2"===a?"第二幕: 対立・葛藤":"第三幕: 解決"}),(0,b.jsx)("span",{className:"text-sm font-black font-mono text-zinc-400 bg-zinc-200/50 px-2 py-0.5 rounded dark:bg-zinc-800",children:"1"===a?"SETUP":"2"===a?"CONFRONTATION":"RESOLUTION"})]}),(0,b.jsxs)("div",{className:"text-sm leading-relaxed text-zinc-600 font-medium",children:["1"===a&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("p",{className:"mb-0.5",children:"物語の舞台は？"}),(0,b.jsx)("p",{children:"主人公が解決しなければいけない問題は？"})]}),"2"===a&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("p",{className:"mb-0.5",children:"主人公が挑戦・失敗・悩む姿は？"}),(0,b.jsx)("p",{children:"どんな敵や障害が現れる？"})]}),"3"===a&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("p",{className:"mb-0.5",children:"第一幕で提示した問題の答えは？"}),(0,b.jsx)("p",{children:"主人公はどう変わった？"})]})]})]}),(0,b.jsx)(p.SortableContext,{id:a,items:e.filter(b=>b.act===a).map(a=>a.id),strategy:p.verticalListSortingStrategy,children:(0,b.jsxs)("div",{className:"flex-1 p-4 overflow-y-auto space-y-3 min-h-[100px]",children:[e.filter(b=>b.act===a).map(a=>(0,b.jsx)(s,{card:a,onDelete:r,onUpdate:q},a.id)),(0,b.jsxs)(i.Button,{variant:"outline",size:"sm",className:"w-full border-dashed text-zinc-400 hover:text-zinc-600 dark:border-zinc-800 dark:hover:text-zinc-300",onClick:()=>{let b;f(b=[...e,{id:crypto.randomUUID(),content:"",act:a,tags:[]}]),d({structureBoard:b})},children:[(0,b.jsx)(l.Plus,{size:14,className:"mr-1"})," カード追加"]})]})}),(0,b.jsxs)("div",{className:"p-4 pt-0 border-t border-zinc-200 dark:border-zinc-800 bg-zinc-50/50 dark:bg-zinc-900/30 rounded-b-xl space-y-3",children:["1"===a&&(0,b.jsxs)("div",{className:"mt-3",children:[(0,b.jsx)("label",{className:"text-sm font-black text-rose-500 uppercase tracking-widest mb-1.5 block",children:"ターニングポイント 1 (TP1)"}),(0,b.jsx)("textarea",{value:g.tp1,onChange:a=>m("tp1",a.target.value),placeholder:"物語が大きく動き出す瞬間...",rows:2,className:"w-full text-sm p-2.5 rounded-lg border border-zinc-200 bg-white shadow-sm focus:outline-none focus:ring-1 focus:ring-rose-500 dark:bg-zinc-950 dark:border-zinc-800 dark:text-white"})]}),"2"===a&&(0,b.jsxs)("div",{className:"mt-3 space-y-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm font-black text-amber-500 uppercase tracking-widest mb-1.5 block",children:"中間点 (MP)"}),(0,b.jsx)("textarea",{value:g.midpoint,onChange:a=>m("midpoint",a.target.value),placeholder:"物語の折り返し地点...",rows:2,className:"w-full text-sm p-2.5 rounded-lg border border-zinc-200 bg-white shadow-sm focus:outline-none focus:ring-1 focus:ring-amber-500 dark:bg-zinc-950 dark:border-zinc-800 dark:text-white"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm font-black text-rose-600 uppercase tracking-widest mb-1.5 block",children:"ターニングポイント 2 (TP2)"}),(0,b.jsx)("textarea",{value:g.tp2,onChange:a=>m("tp2",a.target.value),placeholder:"クライマックスへの突入...",rows:2,className:"w-full text-sm p-2.5 rounded-lg border border-zinc-200 bg-white shadow-sm focus:outline-none focus:ring-1 focus:ring-rose-600 dark:bg-zinc-950 dark:border-zinc-800 dark:text-white"})]})]}),"3"===a&&(0,b.jsx)("div",{className:"py-2 text-center",children:(0,b.jsx)("div",{className:"text-sm font-black text-zinc-400 uppercase tracking-widest",children:"Fin."})})]})]},a))}),(0,b.jsx)(o.DragOverlay,{dropAnimation:{sideEffects:(0,o.defaultDropAnimationSideEffects)({styles:{active:{opacity:"0.5"}}})},children:j?(0,b.jsx)(s,{card:e.find(a=>a.id===j),isOverlay:!0}):null})]})})}},{id:"4",label:"4. キャラクター選択",component:({project:a,onUpdate:e})=>{let{characters:f,addCharacter:g}=(0,t.useCharacters)(),[h,j]=(0,c.useState)(!1),[k,n]=(0,c.useState)(""),o=a.linkedCharacterIds||[],p=f.filter(a=>o.includes(a.id)),q=a.characters||[],r=a=>{e({linkedCharacterIds:o.includes(a)?o.filter(b=>b!==a):[...o,a]})};return(0,b.jsxs)("div",{className:"space-y-8 animate-in fade-in slide-in-from-bottom-4 duration-500",children:[(0,b.jsxs)("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-6",children:[(0,b.jsxs)("div",{children:[(0,b.jsxs)("h2",{className:"text-xl font-bold flex items-center gap-2 text-white",children:[(0,b.jsx)("span",{className:"flex items-center justify-center w-8 h-8 rounded-full bg-white text-zinc-900 text-sm",children:"4"}),"キャラクター選択"]}),(0,b.jsx)("p",{className:"text-sm text-zinc-500 mt-1",children:"この作品に登場させるキャラクターを名簿から選択します。"})]}),(0,b.jsxs)("div",{className:"flex flex-col sm:flex-row gap-2 w-full md:w-auto",children:[(0,b.jsx)(d.default,{href:"/characters",className:"w-full md:w-auto",children:(0,b.jsxs)(i.Button,{variant:"ghost",className:"w-full md:w-auto text-zinc-400 hover:text-white font-bold border border-zinc-800",children:[(0,b.jsx)(z,{className:"w-4 h-4 mr-2"})," 名簿の編集"]})}),(0,b.jsxs)(i.Button,{onClick:()=>j(!h),className:"w-full md:w-auto font-bold bg-white text-zinc-900 hover:bg-zinc-200",children:[(0,b.jsx)(l.Plus,{className:"w-4 h-4 mr-2"})," キャラクターを参加させる"]})]})]}),h&&(0,b.jsxs)("div",{className:"bg-[#0a0a0a] border border-zinc-800 rounded-2xl p-6 space-y-4 animate-in zoom-in-95 duration-200 shadow-2xl",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("h3",{className:"font-bold text-sm text-zinc-400 uppercase tracking-widest",children:"グローバル名簿から選択"}),(0,b.jsx)("button",{onClick:()=>j(!1),className:"text-zinc-600 hover:text-white transition-colors",children:(0,b.jsx)(m.X,{size:18})})]}),(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(w.Search,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-zinc-600"}),(0,b.jsx)("input",{type:"text",placeholder:"名前で検索、または新規作成して追加...",value:k,onChange:a=>n(a.target.value),className:"w-full bg-zinc-900/50 border border-zinc-800 rounded-xl pl-10 pr-4 h-12 text-base focus:outline-none focus:ring-1 focus:ring-zinc-700"})]}),(0,b.jsxs)("div",{className:"grid grid-cols-2 lg:grid-cols-3 gap-3 max-h-[400px] overflow-y-auto pr-2 scrollbar-hide",children:[f.filter(a=>a.name.toLowerCase().includes(k.toLowerCase())).map(a=>(0,b.jsxs)("button",{onClick:()=>r(a.id),className:`flex items-center gap-3 p-3 rounded-xl border transition-all text-left group ${o.includes(a.id)?"bg-white border-white text-black":"bg-zinc-900/50 border-zinc-800 text-zinc-500 hover:border-zinc-600 hover:text-zinc-300"}`,children:[(0,b.jsx)("div",{className:"w-10 h-10 rounded-full bg-black/20 border border-zinc-700/30 overflow-hidden shrink-0",children:a.icon?(0,b.jsx)("img",{src:a.icon,alt:a.name,className:"w-full h-full object-cover"}):(0,b.jsx)("div",{className:"w-full h-full flex items-center justify-center",children:(0,b.jsx)(u.User,{size:16})})}),(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsx)("div",{className:"font-bold text-sm truncate",children:a.name}),(0,b.jsx)("div",{className:"text-sm opacity-60 truncate",children:o.includes(a.id)?"参戦中":"待機中"})]}),(0,b.jsx)("div",{className:`p-1 rounded-full ${o.includes(a.id)?"bg-black text-white":"bg-transparent text-transparent group-hover:bg-zinc-800"}`,children:(0,b.jsx)(x.Check,{size:12})})]},a.id)),k&&!f.find(a=>a.name.toLowerCase()===k.toLowerCase())&&(0,b.jsxs)("button",{onClick:()=>{r(g({name:k||"新しいキャラクター",description:""}).id),n("")},className:"flex items-center gap-3 p-3 rounded-xl border border-dashed border-zinc-800 text-zinc-500 hover:border-zinc-600 hover:text-white transition-all text-left",children:[(0,b.jsx)("div",{className:"w-10 h-10 rounded-full bg-zinc-900 border border-zinc-800 flex items-center justify-center shrink-0 text-zinc-700",children:(0,b.jsx)(l.Plus,{size:16})}),(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsxs)("div",{className:"font-bold text-sm truncate text-zinc-300",children:["「",k,"」を登録"]}),(0,b.jsx)("div",{className:"text-sm",children:"名簿へ追加してこの作品にリンク"})]})]})]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[p.map(a=>(0,b.jsxs)("div",{className:"bg-[#192a31] rounded-2xl border border-zinc-800 p-6 flex gap-6 relative group transform transition-all hover:scale-[1.01] hover:border-zinc-600 shadow-xl",children:[(0,b.jsxs)("div",{className:"relative shrink-0",children:[(0,b.jsx)("div",{className:"w-20 h-20 rounded-full bg-black border-2 border-zinc-800 overflow-hidden",children:a.icon?(0,b.jsx)("img",{src:a.icon,alt:a.name,className:"w-full h-full object-cover"}):(0,b.jsx)("div",{className:"w-full h-full flex items-center justify-center text-zinc-800",children:(0,b.jsx)(u.User,{size:32})})}),(0,b.jsx)("div",{className:"absolute -bottom-1 -right-1 w-7 h-7 bg-white text-black rounded-full flex items-center justify-center border-4 border-[#192a31]",children:(0,b.jsx)(y,{size:12})})]}),(0,b.jsxs)("div",{className:"flex-1 space-y-1",children:[(0,b.jsx)("div",{className:"text-xl font-bold text-white",children:a.name}),(0,b.jsx)("div",{className:"text-sm text-zinc-500 leading-relaxed line-clamp-2",children:a.description||"（説明なし）"}),(0,b.jsx)("span",{className:"text-sm font-black uppercase tracking-widest px-2 py-0.5 rounded bg-zinc-900 border border-zinc-800 text-zinc-400",children:"リンク中"},a.id+"-link")]}),(0,b.jsxs)("button",{onClick:()=>r(a.id),className:"absolute top-4 right-4 p-2 text-zinc-600 hover:text-red-500 opacity-0 group-hover:opacity-100 transition-all font-bold text-sm flex items-center gap-1",children:[(0,b.jsx)(v.Trash2,{size:14})," 除外"]})]},a.id)),q.map(a=>(0,b.jsxs)("div",{className:"bg-[#192a31]/50 border-2 border-dashed border-zinc-800 rounded-2xl p-6 flex gap-6 relative group opacity-60 grayscale hover:grayscale-0 hover:opacity-100 transition-all",children:[(0,b.jsx)("div",{className:"w-20 h-20 rounded-full bg-zinc-900 border border-zinc-800 overflow-hidden flex items-center justify-center text-zinc-700",children:a.icon?(0,b.jsx)("img",{src:a.icon,alt:a.name,className:"w-full h-full object-cover"}):(0,b.jsx)(u.User,{size:32})}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("div",{className:"font-bold text-white",children:a.name}),(0,b.jsx)("div",{className:"text-sm text-zinc-600",children:"プロジェクト固有（レガシー）"})]})]},a.id)),0===p.length&&0===q.length&&(0,b.jsxs)("div",{className:"md:col-span-2 py-20 flex flex-col items-center justify-center border-2 border-dashed border-[#192a31] bg-[#192a31]/40 rounded-3xl",children:[(0,b.jsx)(u.User,{className:"w-12 h-12 text-zinc-800 mb-4"}),(0,b.jsx)("p",{className:"text-zinc-700 font-bold uppercase tracking-widest text-sm",children:"登場キャラクターが未選択です"}),(0,b.jsx)(i.Button,{onClick:()=>j(!0),variant:"ghost",className:"mt-4 text-zinc-500 hover:text-white",children:"名簿から選択する"})]})]})]})}},{id:"5",label:"5. ネーム制作",component:({project:a,episode:d,onUpdate:e})=>{let{characters:f,groups:g}=(0,t.useCharacters)(),h=d.linkedCharacterIds||[],j=Array.from(new Map([...f.filter(a=>h.includes(a.id)),...a.characters||[]].map(a=>[a.id,a])).values()),[k,l]=(0,c.useState)(d.structureBoard||[]),[m,n]=(0,c.useState)(null),[q,r]=(0,c.useState)(null),[s,u]=(0,c.useState)({isOpen:!1,panel:null,groupId:""});(0,c.useEffect)(()=>{l(d.structureBoard||[])},[d.structureBoard]);let v=(0,o.useSensors)((0,o.useSensor)(o.PointerSensor,{activationConstraint:{distance:8,delay:100}}),(0,o.useSensor)(o.KeyboardSensor,{coordinateGetter:p.sortableKeyboardCoordinates})),w=(a,b)=>{u({isOpen:!0,panel:a,groupId:b})},x=a=>{let b={id:crypto.randomUUID(),drawing:"",dialogues:[]},c=k.map(c=>c.id===a?{...c,scenes:[...c.scenes||[],b]}:c);l(c),e({structureBoard:c})},y=async(a,b,c)=>{let d=k.map(d=>d.id===a?{...d,scenes:(d.scenes||[]).map(a=>a.id===b?{...a,...c}:a)}:d);l(d),e({structureBoard:d})},z=(a,b)=>{let c=k.map(c=>c.id===a?{...c,scenes:(c.scenes||[]).filter(a=>a.id!==b)}:c);l(c),e({structureBoard:c})},A=(a,b)=>{let c={id:crypto.randomUUID(),character:"",text:"",memo:""},d=k.map(d=>d.id===a?{...d,scenes:(d.scenes||[]).map(a=>a.id===b?{...a,dialogues:[...a.dialogues||[],c]}:a)}:d);l(d),e({structureBoard:d})},C=(a,b,c,d)=>{let f=k.map(e=>e.id===a?{...e,scenes:(e.scenes||[]).map(a=>a.id===b?{...a,dialogues:(a.dialogues||[]).map(a=>a.id===c?{...a,...d}:a)}:a)}:e);l(f),e({structureBoard:f})},D=(a,b,c)=>{let d=k.map(d=>d.id===a?{...d,scenes:(d.scenes||[]).map(a=>a.id===b?{...a,dialogues:(a.dialogues||[]).filter(a=>a.id!==c)}:a)}:d);l(d),e({structureBoard:d})},E=k.flatMap(a=>a.scenes||[]).find(a=>a.id===m);return(0,b.jsxs)("div",{className:"space-y-12 animate-in fade-in slide-in-from-bottom-4 duration-500 pb-20",children:[(0,b.jsxs)("div",{children:[(0,b.jsxs)("h2",{className:"text-2xl font-black flex items-center gap-3 text-white",children:[(0,b.jsx)("span",{className:"flex items-center justify-center w-8 h-8 rounded-full bg-white text-zinc-900 text-sm",children:"5"}),"ネーム制作 (下書き)"]}),(0,b.jsx)("p",{className:"text-zinc-500 text-sm mt-2 font-medium tracking-wide",children:"エピソードをコマ（パネル）に落とし込み、セリフや演出を細かく構築します。"})]}),(0,b.jsxs)(o.DndContext,{sensors:v,collisionDetection:o.closestCenter,onDragStart:a=>{let{active:b}=a;n(b.id),r(b.data.current?.type)},onDragOver:a=>{let{active:b,over:c}=a;if(!c||b.id===c.id)return;let d=b.data.current,e=c.data.current;if(d?.type==="dialogue"){let a=d.panelId,f="";e?.type==="dialogue"||e?.type==="dialogue-container"?f=e.panelId:e?.type==="panel"&&(f=c.id),f&&a!==f&&(l(d=>{let e,g=JSON.parse(JSON.stringify(d));return g.forEach(c=>{c.scenes?.forEach(c=>{if(c.id===a){let a=c.dialogues?.findIndex(a=>a.id===b.id);-1!==a&&(e=c.dialogues[a],c.dialogues.splice(a,1))}})}),e&&g.forEach(a=>{a.scenes?.forEach(a=>{if(a.id===f){a.dialogues=a.dialogues||[];let b=a.dialogues.findIndex(a=>a.id===c.id);b>=0?a.dialogues.splice(b,0,e):a.dialogues.push(e)}})}),g}),b.data.current.panelId=f)}else if(d?.type==="panel"){let a=d.parentId,f=e?.type==="panel"?e.parentId:c.id;a!==f&&(l(d=>{let e,g=JSON.parse(JSON.stringify(d));return g.forEach(c=>{c.id===a&&(e=c.scenes?.find(a=>a.id===b.id),c.scenes=c.scenes?.filter(a=>a.id!==b.id))}),e&&g.forEach(a=>{if(a.id===f){let b=[...a.scenes||[]],d=b.findIndex(a=>a.id===c.id);d>=0?b.splice(d,0,e):b.push(e),a.scenes=b}}),g}),b.data.current.parentId=f)}},onDragEnd:a=>{let{active:b,over:c}=a;if(n(null),r(null),c){if(b.id!==c.id){let a=b.data.current,d=c.data.current;if(a?.type==="dialogue"){let a="";k.forEach(c=>c.scenes?.forEach(c=>{c.dialogues?.some(a=>a.id===b.id)&&(a=c.id)}));let e=d?.panelId||(d?.type==="panel"?c.id:null);a&&a===e&&l(d=>d.map(d=>({...d,scenes:(d.scenes||[]).map(d=>{if(d.id===a){let a=d.dialogues?.findIndex(a=>a.id===b.id)??-1,e=d.dialogues?.findIndex(a=>a.id===c.id)??-1;if(-1!==a&&-1!==e)return{...d,dialogues:(0,p.arrayMove)(d.dialogues,a,e)}}return d})})))}else if(a?.type==="panel"){let a="";k.forEach(c=>{c.scenes?.some(a=>a.id===b.id)&&(a=c.id)});let e=d?.parentId||(d?.type==="container"?c.id:null);a&&a===e&&l(d=>d.map(d=>{if(d.id===a){let a=d.scenes||[],e=a.findIndex(a=>a.id===b.id)??-1,f=a.findIndex(a=>a.id===c.id)??-1;if(-1!==e&&-1!==f)return{...d,scenes:(0,p.arrayMove)(a,e,f)}}return d}))}}e({structureBoard:k})}},children:[(0,b.jsx)("div",{className:"space-y-20",children:0===k.length?(0,b.jsxs)("div",{className:"py-20 flex flex-col items-center justify-center border-2 border-dashed border-zinc-800 rounded-3xl bg-white/5",children:[(0,b.jsx)(B,{size:48,className:"text-zinc-500 mb-4"}),(0,b.jsx)("p",{className:"text-zinc-300 font-bold mb-2",children:"構成データが見つかりません"}),(0,b.jsxs)("p",{className:"text-zinc-400 text-sm text-center leading-relaxed",children:['Step 3 "構成・構成案" でエピソードの構成を作成してください。',(0,b.jsx)("br",{}),"または、データが読み込まれていない可能性があります。"]}),(0,b.jsx)(i.Button,{variant:"outline",size:"sm",onClick:()=>window.location.reload(),className:"mt-6 text-sm border-zinc-700 text-zinc-300 hover:text-white hover:bg-zinc-800",children:"ページをリロード"})]}):k.map(a=>(0,b.jsx)(K,{group:a,activeId:m,activeType:q,characters:j,groups:g,onAddItem:x,onUpdateItem:y,onDeleteItem:z,onAddDialogue:A,onUpdateDialogue:C,onDeleteDialogue:D,onOpenModal:w},a.id))}),(0,b.jsx)(o.DragOverlay,{dropAnimation:{sideEffects:(0,o.defaultDropAnimationSideEffects)({styles:{active:{opacity:"0.4"}}})},children:m&&"panel"===q&&E?(0,b.jsx)("div",{className:"w-[800px] shadow-[0_0_50px_rgba(255,255,255,0.1)]",children:(0,b.jsx)(J,{item:E,parentId:((a,b)=>{if("panel"===b)return k.find(b=>b.id===a||b.scenes?.some(b=>b.id===a))?.id;for(let b of k)for(let c of b.scenes||[])if(c.dialogues?.some(b=>b.id===a))return b.id;return null})(m,"panel"),activeId:null,activeType:null,characters:j,groups:g,onUpdateItem:y,onDeleteItem:z,onAddDialogue:A,onUpdateDialogue:C,onDeleteDialogue:D,onOpenModal:w})}):null})]}),s.isOpen&&s.panel&&(0,b.jsx)(H,{isOpen:s.isOpen,onClose:()=>u(a=>({...a,isOpen:!1})),initialData:s.panel.drawing,onSave:a=>{s.panel&&(y(s.groupId,s.panel.id,{drawing:a}),u(b=>({...b,panel:{...b.panel,drawing:a}})))}})]})}},{id:"6",label:"6. 企画書出力",component:({project:a})=>{let{characters:c,groups:d}=(0,t.useCharacters)(),e=(a.linkedCharacterIds||[]).map(a=>c.find(b=>b.id===a)).filter(a=>!!a),f=e.length>0?e:a.characters||[],g=(a.structureBoard||[]).flatMap(a=>(a.scenes||[]).map(b=>({...b,groupTitle:a.content,groupTags:a.tags})));return(0,b.jsxs)("div",{className:"max-w-4xl mx-auto space-y-8 animate-in fade-in slide-in-from-bottom-4 duration-500",children:[(0,b.jsxs)("div",{className:"bg-zinc-100 dark:bg-zinc-900 p-4 rounded-xl border border-zinc-200 dark:border-zinc-800 flex flex-col md:flex-row items-center justify-between gap-4 print:hidden",children:[(0,b.jsxs)("div",{children:[(0,b.jsxs)("h2",{className:"text-xl font-bold flex items-center gap-2 text-zinc-900 dark:text-zinc-50",children:[(0,b.jsx)("span",{className:"flex items-center justify-center w-8 h-8 rounded-full bg-zinc-900 text-zinc-50 text-sm dark:bg-zinc-100 dark:text-zinc-900",children:"6"}),"企画書出力"]}),(0,b.jsx)("p",{className:"text-zinc-500 dark:text-zinc-400 text-sm",children:"下のボタンを押すと、このページを印刷またはPDFとして保存できます。"})]}),(0,b.jsxs)(i.Button,{onClick:()=>{window.print()},className:"font-bold px-6 rounded-full shadow-lg",children:[(0,b.jsx)(M,{size:18,className:"mr-2"}),"印刷 / PDF保存"]})]}),(0,b.jsxs)("div",{className:"jsx-487bc265117af5a6 print-container bg-white text-black p-8 md:p-16 rounded-sm shadow-2xl min-h-[297mm] relative overflow-hidden",children:[(0,b.jsx)(L.default,{id:"487bc265117af5a6",children:"@media print{@page{size:A4;margin:0}body{background:#fff}aside,header,nav,.print\\:hidden{display:none!important}main{width:100%!important;max-width:none!important;margin:0!important;padding:0!important}.print-container{width:100%;box-shadow:none;visibility:visible;border:none;margin:0;padding:20mm;position:absolute;top:0;left:0}.page-break{page-break-before:always}.keep-together{break-inside:avoid}}"}),(0,b.jsxs)("section",{className:"jsx-487bc265117af5a6 mb-16 border-b-4 border-black pb-8",children:[(0,b.jsx)("div",{className:"jsx-487bc265117af5a6 text-sm font-bold tracking-widest text-zinc-500 uppercase mb-2",children:"Project Proposal"}),(0,b.jsx)("h1",{className:"jsx-487bc265117af5a6 text-5xl font-black mb-6 leading-tight",children:a.title||"無題のプロジェクト"}),(0,b.jsx)("p",{className:"jsx-487bc265117af5a6 text-xl font-medium leading-relaxed text-zinc-700 whitespace-pre-wrap",children:a.description||"ログライン（一行あらすじ）が入力されていません。"}),(0,b.jsx)("div",{className:"jsx-487bc265117af5a6 mt-8 flex gap-4 text-sm text-zinc-500",children:(0,b.jsxs)("span",{className:"jsx-487bc265117af5a6",children:["最終更新: ",new Date(a.lastEdited).toLocaleDateString()]})})]}),(0,b.jsxs)("section",{className:"jsx-487bc265117af5a6 mb-12 keep-together",children:[(0,b.jsxs)("h3",{className:"jsx-487bc265117af5a6 text-2xl font-bold border-l-8 border-black pl-4 mb-6 flex items-center gap-2",children:[(0,b.jsx)(N.BookOpen,{size:24})," 企画コンセプト"]}),(0,b.jsxs)("div",{className:"jsx-487bc265117af5a6 grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,b.jsxs)("div",{className:"jsx-487bc265117af5a6 bg-zinc-50 p-6 rounded-lg border border-zinc-100",children:[(0,b.jsx)("h4",{className:"jsx-487bc265117af5a6 font-bold text-zinc-400 text-sm uppercase mb-2",children:"テーマ (Theme)"}),(0,b.jsx)("p",{className:"jsx-487bc265117af5a6 text-lg font-serif font-bold",children:a.concept?.theme||"-"})]}),(0,b.jsxs)("div",{className:"jsx-487bc265117af5a6 bg-zinc-50 p-6 rounded-lg border border-zinc-100",children:[(0,b.jsx)("h4",{className:"jsx-487bc265117af5a6 font-bold text-zinc-400 text-sm uppercase mb-2",children:"読後感 (Emotion)"}),(0,b.jsx)("p",{className:"jsx-487bc265117af5a6 text-lg",children:a.concept?.emotions||"-"})]})]})]}),(0,b.jsxs)("section",{className:"jsx-487bc265117af5a6 mb-12",children:[(0,b.jsxs)("h3",{className:"jsx-487bc265117af5a6 text-2xl font-bold border-l-8 border-black pl-4 mb-6 flex items-center gap-2",children:[(0,b.jsx)(u.User,{size:24})," 主要キャラクター"]}),(0,b.jsx)("div",{className:"jsx-487bc265117af5a6 grid grid-cols-1 gap-6",children:f.length>0?f.map(a=>(0,b.jsxs)("div",{className:"jsx-487bc265117af5a6 flex gap-6 p-4 border border-zinc-200 rounded-xl items-start keep-together",children:[(0,b.jsx)("div",{className:"jsx-487bc265117af5a6 w-20 h-20 bg-zinc-100 rounded-full shrink-0 overflow-hidden border border-zinc-200",children:a.icon?(0,b.jsx)("img",{src:a.icon,alt:a.name,className:"jsx-487bc265117af5a6 w-full h-full object-cover grayscale"}):(0,b.jsx)("div",{className:"jsx-487bc265117af5a6 w-full h-full flex items-center justify-center text-zinc-300",children:(0,b.jsx)(u.User,{size:32})})}),(0,b.jsxs)("div",{className:"jsx-487bc265117af5a6 flex-1",children:[(0,b.jsx)("div",{className:"jsx-487bc265117af5a6 flex items-center gap-2 mb-1",children:(0,b.jsx)("h4",{className:"jsx-487bc265117af5a6 text-lg font-bold",children:a.name})}),(0,b.jsx)("p",{className:"jsx-487bc265117af5a6 text-sm text-zinc-700 whitespace-pre-wrap leading-relaxed",children:a.description||"詳細設定なし"})]})]},a.id)):(0,b.jsx)("p",{className:"jsx-487bc265117af5a6 text-zinc-400 italic",children:"キャラクターが登録されていません。"})})]}),(0,b.jsx)("div",{className:"jsx-487bc265117af5a6 page-break"}),(0,b.jsxs)("section",{className:"jsx-487bc265117af5a6 mb-12 mt-8",children:[(0,b.jsxs)("h3",{className:"jsx-487bc265117af5a6 text-2xl font-bold border-l-8 border-black pl-4 mb-6 flex items-center gap-2",children:[(0,b.jsx)(O,{size:24})," ストーリーライン"]}),(0,b.jsxs)("div",{className:"jsx-487bc265117af5a6 grid grid-cols-2 gap-4 mb-8",children:[(0,b.jsxs)("div",{className:"jsx-487bc265117af5a6 p-4 bg-zinc-50 border-l-4 border-zinc-300",children:[(0,b.jsx)("span",{className:"jsx-487bc265117af5a6 block text-sm font-bold text-zinc-400 mb-1",children:"START"}),(0,b.jsx)("p",{className:"jsx-487bc265117af5a6 font-medium text-sm",children:a.outline?.start||"-"})]}),(0,b.jsxs)("div",{className:"jsx-487bc265117af5a6 p-4 bg-zinc-50 border-l-4 border-zinc-300",children:[(0,b.jsx)("span",{className:"jsx-487bc265117af5a6 block text-sm font-bold text-zinc-400 mb-1",children:"GOAL"}),(0,b.jsx)("p",{className:"jsx-487bc265117af5a6 font-medium text-sm",children:a.outline?.end||"-"})]})]}),(0,b.jsxs)("div",{className:"jsx-487bc265117af5a6 space-y-4",children:[(0,b.jsx)("h4",{className:"jsx-487bc265117af5a6 font-bold text-lg mb-4 border-b border-zinc-200 pb-2",children:"シーン構成 (ネーム)"}),g.length>0?g.map((a,c)=>(0,b.jsxs)("div",{className:"jsx-487bc265117af5a6 flex gap-4 items-baseline border-b border-zinc-100 pb-3 keep-together",children:[(0,b.jsxs)("span",{className:"jsx-487bc265117af5a6 font-mono text-zinc-400 w-8 shrink-0 text-right",children:["#",c+1]}),(0,b.jsxs)("div",{className:"jsx-487bc265117af5a6 flex-1",children:[(0,b.jsxs)("div",{className:"jsx-487bc265117af5a6 mb-1 flex items-center gap-2",children:[(0,b.jsx)("span",{className:"jsx-487bc265117af5a6 font-bold text-sm text-zinc-500 uppercase",children:a.groupTitle}),a.groupTags&&a.groupTags.length>0&&(0,b.jsx)("div",{className:"jsx-487bc265117af5a6 flex gap-1",children:a.groupTags.map(a=>(0,b.jsx)("span",{className:`jsx-487bc265117af5a6 px-1.5 py-0.5 text-sm rounded border font-bold bg-white ${r[a]?.color} border-zinc-300`,children:r[a]?.label},a))})]}),a.drawing&&(0,b.jsx)("div",{className:"jsx-487bc265117af5a6 mb-2 w-32 h-20 border border-zinc-200 bg-zinc-50 overflow-hidden",children:(0,b.jsx)("img",{src:a.drawing,className:"jsx-487bc265117af5a6 w-full h-full object-contain"})}),(0,b.jsx)("div",{className:"jsx-487bc265117af5a6 space-y-1",children:a.dialogues?.map((a,c)=>{let d=f.find(b=>b.id===a.characterId);return(0,b.jsxs)("div",{className:"jsx-487bc265117af5a6 text-sm flex gap-2",children:[(0,b.jsx)("span",{className:"jsx-487bc265117af5a6 font-bold text-zinc-600 shrink-0 text-sm w-16 truncate",children:d?.name||a.character||"???"}),(0,b.jsxs)("span",{className:"jsx-487bc265117af5a6 text-zinc-800",children:["「",a.text,"」"]})]},c)})})]})]},a.id)):(0,b.jsx)("p",{className:"jsx-487bc265117af5a6 text-zinc-400 italic",children:"シーンが作成されていません。"})]})]}),(0,b.jsxs)("div",{className:"jsx-487bc265117af5a6 mt-20 pt-8 border-t border-zinc-200 text-center text-zinc-400 text-sm flex justify-between items-center",children:[(0,b.jsx)("span",{className:"jsx-487bc265117af5a6",children:"Generated by Manga Support App"}),(0,b.jsxs)("span",{className:"jsx-487bc265117af5a6",children:[new Date().toLocaleDateString()," 出力"]})]})]})]})}}];function R({projectId:a,episodeId:e}){let{project:l,episode:m,loading:n,updateEpisode:o}=((a,b)=>{let{project:d,loading:e,updateProject:f}=(0,j.useProject)(a),[g,h]=(0,c.useState)(null),[i,k]=(0,c.useState)(!0),l=(0,c.useRef)(null);return(0,c.useEffect)(()=>{e||(d?h(d.episodes?.find(a=>a.id===b)||null):h(null),k(!1))},[d,b,e]),{project:d,episode:g,loading:i||e,updateEpisode:c=>{if(!d||!g)return;let e={...g,...c,lastEdited:new Date().toISOString()};h(e),f({episodes:d.episodes?.map(a=>a.id===b?e:a)||[]},{localOnly:!0}),l.current&&clearTimeout(l.current),l.current=setTimeout(async()=>{try{await fetch(`/api/projects/${a}/episodes/${b}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)})}catch(a){console.error("Episode auto-save failed",a)}},1e3)}}})(a,e),[p,q]=(0,c.useState)("1"),[r,s]=(0,c.useState)(!1);if(n)return(0,b.jsx)("div",{className:"p-10 text-center text-zinc-500",children:"Loading..."});if(!l)return(0,b.jsx)("div",{className:"p-10 text-center text-zinc-500",children:"Project Not Found"});if(!m)return(0,b.jsx)("div",{className:"p-10 text-center text-zinc-500",children:"Episode Not Found"});let t=Q.find(a=>a.id===p)?.component||k,u={...l,...m,id:l.id},v=()=>(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{className:"p-6 border-b border-zinc-800",children:[(0,b.jsxs)(d.default,{href:`/projects/${a}`,className:"flex items-center text-xs text-zinc-400 hover:text-white mb-4 transition-colors",children:[(0,b.jsx)(g.ArrowLeft,{className:"w-3 h-3 mr-1"}),"シリーズ詳細へ戻る"]}),(0,b.jsx)("h1",{className:"font-bold text-sm text-zinc-400 mb-1 truncate",children:l.title}),(0,b.jsx)("h2",{className:"font-bold text-xl text-white truncate",children:m.title})]}),(0,b.jsxs)("nav",{className:"flex-1 p-4 space-y-1 overflow-y-auto",children:[(0,b.jsx)("div",{className:"text-[10px] font-black text-zinc-500 uppercase tracking-widest px-4 mb-2",children:"制作ステップ"}),Q.map(a=>(0,b.jsxs)(i.Button,{onClick:()=>{q(a.id),s(!1)},variant:p===a.id?"default":"ghost",className:`w-full justify-start text-left overflow-hidden ${p===a.id?"font-bold bg-[#0077BE] text-white hover:bg-[#0077BE]/90":"text-zinc-400 hover:text-white hover:bg-zinc-800"}`,children:[(0,b.jsx)("span",{className:"flex-1 truncate",children:a.label}),p===a.id&&(0,b.jsx)(f,{className:"w-4 h-4 opacity-100 flex-shrink-0 ml-2"})]},a.id))]}),(0,b.jsx)("div",{className:"p-4 border-t border-zinc-800 mt-auto",children:(0,b.jsx)(P.UserMenu,{showName:!0})})]});return(0,b.jsxs)("div",{className:"flex bg-zinc-50 min-h-screen dark:bg-zinc-950",children:[(0,b.jsx)("aside",{className:"w-64 fixed h-full bg-[#253341] border-r border-zinc-800 z-30 hidden md:flex flex-col",children:(0,b.jsx)(v,{})}),r&&(0,b.jsx)("div",{className:"md:hidden fixed inset-0 bg-black/50 z-40 transition-opacity",onClick:()=>s(!1)}),(0,b.jsx)("aside",{className:`md:hidden fixed inset-y-0 left-0 w-72 bg-[#253341] z-50 transform transition-transform duration-300 ease-in-out border-r border-zinc-800 ${r?"translate-x-0":"-translate-x-full"}`,children:(0,b.jsx)("div",{className:"flex flex-col h-full border-r border-transparent",children:(0,b.jsx)(v,{})})}),(0,b.jsxs)("header",{className:"md:hidden fixed top-0 w-full bg-white border-b border-zinc-200 z-20 px-4 h-14 flex items-center justify-between dark:bg-zinc-950 dark:border-zinc-800",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("button",{onClick:()=>s(!0),className:"p-1 -ml-1 text-zinc-500 hover:text-zinc-900 dark:text-zinc-400 dark:hover:text-zinc-100",children:(0,b.jsx)(h,{size:20})}),(0,b.jsx)("span",{className:"font-bold text-zinc-900 dark:text-zinc-50 truncate max-w-[200px]",children:m.title})]}),(0,b.jsx)(P.UserMenu,{})]}),(0,b.jsx)("main",{className:"flex-1 md:ml-64 p-4 md:p-8 pt-20 md:pt-8 animate-in fade-in duration-500",children:(0,b.jsx)("div",{className:"max-w-5xl mx-auto",children:(0,b.jsx)(t,{project:u,episode:m,onUpdate:a=>{let b=["title","concept","outline","structureBoard","structureBeats","linkedCharacterIds"],c={};Object.keys(a).forEach(d=>{b.includes(d)&&(c[d]=a[d])}),Object.keys(c).length>0&&o(c)}})})})]})}a.s(["EpisodePageClient",()=>R],96293)}];

//# sourceMappingURL=_f3b18a8a._.js.map